<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalmApp - Tu Compa√±ero de Salud Mental</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4c7c7c;
            --secondary: #6ee7b7;
            --accent: #a5b4fc;
            --danger: #fda4af;
            --warning: #fcd34d;
            --success: #34d399;
            --background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --crisis: #ef4444;
            --therapy: #8b5cf6;
            --sleep: #0ea5e9;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--background);
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(118, 75, 162, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(76, 124, 124, 0.2) 0%, transparent 50%);
            z-index: -1;
        }
        
        /* Efecto Glassmorphism Base */
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
        }
        
        .glass-light {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .glass-heavy {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
        
        .glass-colored {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.15) 0%, 
                rgba(255, 255, 255, 0.08) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
        
        .glass-border {
            position: relative;
            overflow: hidden;
        }
        
        .glass-border::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.4) 50%, 
                transparent 100%);
        }
        
        .glass-border::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 0, 0, 0.1) 50%, 
                transparent 100%);
        }
        
        .card {
            composes: glass;
            border-radius: 20px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, 
                rgba(76, 124, 124, 0.3) 0%, 
                rgba(90, 143, 143, 0.4) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 4px 15px rgba(76, 124, 124, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(76, 124, 124, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, 
                rgba(76, 124, 124, 0.4) 0%, 
                rgba(90, 143, 143, 0.5) 100%);
        }
        
        .btn-crisis {
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.3) 0%, 
                rgba(220, 38, 38, 0.4) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: pulse-crisis 2s infinite;
            box-shadow: 
                0 4px 15px rgba(239, 68, 68, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .btn-therapy {
            background: linear-gradient(135deg, 
                rgba(139, 92, 246, 0.3) 0%, 
                rgba(124, 58, 237, 0.4) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 4px 15px rgba(139, 92, 246, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .btn-success {
            background: linear-gradient(135deg, 
                rgba(52, 211, 153, 0.3) 0%, 
                rgba(16, 185, 129, 0.4) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 4px 15px rgba(52, 211, 153, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        @keyframes pulse-crisis {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 
                    0 4px 15px rgba(239, 68, 68, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 
                    0 8px 25px rgba(239, 68, 68, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
        }
        
        .mood-bar {
            height: 8px;
            border-radius: 4px;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .click-sound {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .click-sound:active {
            transform: scale(0.95);
        }
        
        /* Breathing Balloon Styles con Glassmorphism */
        .breathing-balloon-container {
            width: 300px;
            height: 300px;
            margin: 0 auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .breathing-balloon {
            width: 150px;
            height: 200px;
            background: linear-gradient(135deg, 
                rgba(76, 124, 124, 0.6) 0%, 
                rgba(110, 231, 183, 0.5) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 50%;
            position: relative;
            transition: all 4s ease-in-out;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.2),
                inset 0 -10px 20px rgba(255, 255, 255, 0.1),
                inset 0 10px 20px rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transform-origin: center center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .balloon-string {
            position: absolute;
            bottom: -40px;
            width: 2px;
            height: 40px;
            background: rgba(255, 255, 255, 0.5);
            left: 50%;
            transform: translateX(-50%);
            backdrop-filter: blur(5px);
        }
        
        .balloon-knot {
            position: absolute;
            bottom: -40px;
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            left: 50%;
            transform: translateX(-50%);
            backdrop-filter: blur(5px);
        }
        
        /* Crisis Mode Glassmorphism */
        .crisis-card {
            background: linear-gradient(135deg, 
                rgba(254, 226, 226, 0.2) 0%, 
                rgba(254, 202, 202, 0.15) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-left: 6px solid rgba(239, 68, 68, 0.5);
            animation: pulse-border 2s infinite;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Therapy Chat Glassmorphism */
        .therapy-chat {
            background: linear-gradient(135deg, 
                rgba(245, 243, 255, 0.2) 0%, 
                rgba(237, 233, 254, 0.15) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-left: 4px solid rgba(139, 92, 246, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .therapy-message {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 12px 16px;
            margin-bottom: 10px;
            max-width: 85%;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .user-message {
            background: linear-gradient(135deg, 
                rgba(139, 92, 246, 0.4) 0%, 
                rgba(124, 58, 237, 0.5) 100%);
            backdrop-filter: blur(10px);
            color: white;
            margin-left: auto;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .therapist-message {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            margin-right: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Sleep Module Glassmorphism */
        .sleep-card {
            background: linear-gradient(135deg, 
                rgba(224, 242, 254, 0.2) 0%, 
                rgba(186, 230, 253, 0.15) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-left: 4px solid rgba(14, 165, 233, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Grounding Exercise Glassmorphism */
        .grounding-step {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            border-left: 4px solid rgba(16, 185, 129, 0.5);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .grounding-step.active {
            background: linear-gradient(135deg, 
                rgba(209, 250, 229, 0.2) 0%, 
                rgba(167, 243, 208, 0.15) 100%);
            transform: scale(1.02);
            backdrop-filter: blur(12px);
        }
        
        /* Progress Bar Glassmorphism */
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: rgba(229, 231, 235, 0.2);
            backdrop-filter: blur(5px);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease-in-out;
            background: rgba(16, 185, 129, 0.6);
            backdrop-filter: blur(5px);
        }
        
        /* Habit Tracker Glassmorphism */
        .habit-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(76, 124, 124, 0.5);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }
        
        .habit-checkbox.checked {
            background: rgba(76, 124, 124, 0.5);
            color: white;
            backdrop-filter: blur(5px);
        }
        
        /* Pattern Detection Glassmorphism */
        .pattern-card {
            background: linear-gradient(135deg, 
                rgba(240, 249, 255, 0.2) 0%, 
                rgba(224, 242, 254, 0.15) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-left: 4px solid rgba(14, 165, 233, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Emergency Button Glassmorphism */
        .emergency-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.6) 0%, 
                rgba(220, 38, 38, 0.7) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 
                0 8px 32px rgba(239, 68, 68, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: pulse-crisis-btn 1.5s infinite;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        @keyframes pulse-crisis-btn {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 
                    0 8px 32px rgba(239, 68, 68, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
            50% { 
                transform: scale(1.1); 
                box-shadow: 
                    0 12px 40px rgba(239, 68, 68, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.4);
            }
        }
        
        /* Voice Guidance Glassmorphism */
        .voice-guidance {
            background: linear-gradient(135deg, 
                rgba(236, 253, 245, 0.2) 0%, 
                rgba(209, 250, 229, 0.15) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-left: 4px solid rgba(16, 185, 129, 0.5);
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .voice-btn {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .voice-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        
        /* Ambient Sounds Glassmorphism */
        .ambient-sounds {
            background: linear-gradient(135deg, 
                rgba(240, 249, 255, 0.2) 0%, 
                rgba(224, 242, 254, 0.15) 100%);
            backdrop-filter: blur(12px);
            padding: 10px;
            border-radius: 12px;
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sound-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 8px 12px;
            border-radius: 8px;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sound-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        /* Statistics Glassmorphism */
        .stats-container {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .stats-period {
            background: linear-gradient(135deg, 
                rgba(248, 250, 252, 0.2) 0%, 
                rgba(226, 232, 240, 0.15) 100%);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stats-period:hover {
            background: linear-gradient(135deg, 
                rgba(226, 232, 240, 0.25) 0%, 
                rgba(203, 213, 225, 0.2) 100%);
            transform: translateY(-2px);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(226, 232, 240, 0.2);
        }
        
        /* Modal Glassmorphism */
        .modal-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        /* Input Glassmorphism */
        .glass-input {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px;
            color: white;
            transition: all 0.3s ease;
        }
        
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            outline: none;
            box-shadow: 
                0 0 0 3px rgba(255, 255, 255, 0.1),
                inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        /* Text Area Glassmorphism */
        .glass-textarea {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px;
            color: white;
            transition: all 0.3s ease;
            resize: vertical;
        }
        
        .glass-textarea:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            outline: none;
            box-shadow: 
                0 0 0 3px rgba(255, 255, 255, 0.1),
                inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        /* Range Slider Glassmorphism */
        .glass-range {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* Checkbox Glassmorphism */
        .glass-checkbox {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
        }
        
        .glass-checkbox:checked {
            background: rgba(76, 124, 124, 0.5);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .glass-checkbox:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
        }
        
        /* Radio Button Glassmorphism */
        .glass-radio {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            cursor: pointer;
            position: relative;
        }
        
        .glass-radio:checked {
            background: rgba(76, 124, 124, 0.5);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .glass-radio:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }
        
        /* Mood Button Glassmorphism */
        .mood-btn {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .mood-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        /* Glass Text Colors */
        .text-glass-primary {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .text-glass-secondary {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .text-glass-tertiary {
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* Glass Icons */
        .icon-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }
        
        /* Chart Container Glassmorphism */
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Scrollbar Glassmorphism */
        .glass-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        
        .glass-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-radius: 4px;
        }
        
        .glass-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
            border-radius: 4px;
        }
        
        .glass-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .breathing-balloon-container {
                height: 350px;
            }
            
            .text-5xl, .text-6xl {
                font-size: 2.5rem;
            }
            
            .stats-container {
                max-height: 200px;
            }
            
            .emergency-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body class="text-white">
    <!-- Bot√≥n de Emergencia Fijo -->
    <button id="emergency-btn" class="emergency-btn click-sound" title="Primeros Auxilios Emocionales">
        <i class="fas fa-life-ring"></i>
    </button>

    <!-- Main App Container -->
    <div id="app-container" class="min-h-screen p-4 md:p-8">
        <div id="app" class="max-w-7xl mx-auto">
            
            <!-- Header -->
            <header class="text-center mb-10">
                <div class="card glass-heavy p-8 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center">
                            <div class="w-12 h-12 icon-glass flex items-center justify-center mr-3">
                                <i class="fas fa-brain text-glass-primary text-xl"></i>
                            </div>
                            <div class="text-left">
                                <h2 class="text-lg font-bold text-glass-primary">CalmApp</h2>
                                <p class="text-xs text-glass-secondary">Salud Mental Integral</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="flex items-center glass-light px-4 py-2 rounded-full">
                                <i class="fas fa-heart text-glass-primary mr-2"></i>
                                <span class="text-sm font-medium text-glass-primary">Bienestar: <span id="wellness-score">85</span>/100</span>
                            </div>
                            <button id="participate-study-btn" class="btn-therapy px-4 py-2 rounded-full flex items-center click-sound">
                                <i class="fas fa-flask mr-2"></i>
                                <span>Estudio PSS-10</span>
                            </button>
                        </div>
                    </div>
                    
                    <h1 class="text-5xl md:text-6xl font-extrabold bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent mb-4">
                        CalmApp üåø
                    </h1>
                    <p class="text-lg md:text-xl text-glass-primary mb-2">Tu compa√±ero integral de salud mental</p>
                    <p class="text-sm text-glass-secondary">Herramientas basadas en evidencia para tu bienestar emocional</p>
                </div>
                
                <!-- Quick Stats Bar -->
                <div class="flex flex-wrap justify-center gap-4 mb-8">
                    <div class="flex items-center glass-light px-4 py-2 rounded-full">
                        <i class="fas fa-calendar-alt text-glass-primary mr-2"></i>
                        <span id="current-date" class="text-sm font-medium text-glass-primary"></span>
                    </div>
                    <div class="flex items-center glass-light px-4 py-2 rounded-full">
                        <i class="fas fa-heart text-glass-primary mr-2"></i>
                        <span class="text-sm font-medium text-glass-primary">Sesi√≥n: <span id="session-time">00:00</span></span>
                    </div>
                    <div class="flex items-center glass-light px-4 py-2 rounded-full">
                        <i class="fas fa-chart-line text-glass-primary mr-2"></i>
                        <span class="text-sm font-medium text-glass-primary">Racha: <span id="streak-days">14</span> d√≠as</span>
                    </div>
                    <div class="flex items-center glass-colored px-4 py-2 rounded-full border border-white/30">
                        <i class="fas fa-stethoscope text-white mr-2"></i>
                        <span class="text-sm font-medium text-white">Modo Terap√©utico</span>
                    </div>
                </div>
            </header>

            <!-- Main Grid Layout -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- Left Column -->
                <div class="space-y-6">
                    
                    <!-- Card 1: Registro de √Ånimo Diario -->
                    <div class="card glass-border p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 icon-glass flex items-center justify-center mr-3">
                                <i class="fas fa-heart text-glass-primary"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-glass-primary">Registro de √Ånimo Diario üíú</h2>
                        </div>
                        
                        <div class="mb-6">
                            <p class="text-glass-primary mb-3">¬øC√≥mo te sientes en este momento?</p>
                            
                            <div class="grid grid-cols-3 gap-3 mb-4">
                                <button class="mood-btn click-sound" data-mood="excelente">
                                    <span class="text-2xl mb-2">ü•≥</span>
                                    <span class="font-medium text-glass-primary">Excelente</span>
                                </button>
                                <button class="mood-btn click-sound" data-mood="bien">
                                    <span class="text-2xl mb-2">üòä</span>
                                    <span class="font-medium text-glass-primary">Bien</span>
                                </button>
                                <button class="mood-btn click-sound" data-mood="neutral">
                                    <span class="text-2xl mb-2">üòê</span>
                                    <span class="font-medium text-glass-primary">Neutral</span>
                                </button>
                                <button class="mood-btn click-sound" data-mood="ansioso">
                                    <span class="text-2xl mb-2">üòü</span>
                                    <span class="font-medium text-glass-primary">Ansioso</span>
                                </button>
                                <button class="mood-btn click-sound" data-mood="estresado">
                                    <span class="text-2xl mb-2">üòì</span>
                                    <span class="font-medium text-glass-primary">Estresado</span>
                                </button>
                                <button class="mood-btn click-sound" data-mood="triste">
                                    <span class="text-2xl mb-2">üòî</span>
                                    <span class="font-medium text-glass-primary">Triste</span>
                                </button>
                            </div>
                            
                            <div class="mb-4">
                                <label for="mood-intensity" class="block text-sm font-medium text-glass-primary mb-2">
                                    Intensidad: <span id="intensity-value">5</span>/10
                                </label>
                                <input type="range" id="mood-intensity" min="1" max="10" value="5" class="glass-range">
                            </div>
                            
                            <div class="mb-4">
                                <label for="mood-notes" class="block text-sm font-medium text-glass-primary mb-2">
                                    Notas (opcional):
                                </label>
                                <textarea id="mood-notes" rows="3" placeholder="¬øQu√© est√° influyendo en tu estado de √°nimo hoy? Ej: Buen d√≠a de trabajo, dorm√≠ bien, discusi√≥n con amigo..." class="glass-textarea w-full"></textarea>
                            </div>
                            
                            <button id="save-mood-btn" class="btn-success w-full py-3 click-sound">
                                <i class="far fa-save mr-2"></i>
                                Guardar Registro Emocional
                            </button>
                            
                            <div id="mood-status" class="mt-3 text-center text-sm font-medium text-glass-primary"></div>
                        </div>
                    </div>
                    
                    <!-- Card 2: H√°bitos Saludables -->
                    <div class="card glass-border p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 icon-glass flex items-center justify-center mr-3">
                                <i class="fas fa-tasks text-glass-primary"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-glass-primary">H√°bitos Saludables üìã</h2>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- H√°bito 1: Ejercicio -->
                            <div class="flex items-center justify-between p-3 glass-light rounded-lg">
                                <div class="flex items-center">
                                    <div class="habit-checkbox mr-3" id="habit-exercise"></div>
                                    <div>
                                        <div class="font-medium text-glass-primary">Ejercicio F√≠sico</div>
                                        <div class="text-xs text-glass-secondary">20 min m√≠nimo</div>
                                    </div>
                                </div>
                                <div class="text-sm text-emerald-300">+2 √°nimo</div>
                            </div>
                            
                            <!-- H√°bito 2: Meditaci√≥n -->
                            <div class="flex items-center justify-between p-3 glass-light rounded-lg">
                                <div class="flex items-center">
                                    <div class="habit-checkbox mr-3" id="habit-meditation"></div>
                                    <div>
                                        <div class="font-medium text-glass-primary">Meditaci√≥n</div>
                                        <div class="text-xs text-glass-secondary">10 min diarios</div>
                                    </div>
                                </div>
                                <div class="text-sm text-emerald-300">-3 estr√©s</div>
                            </div>
                            
                            <!-- H√°bito 3: Agua -->
                            <div class="flex items-center justify-between p-3 glass-light rounded-lg">
                                <div class="flex items-center">
                                    <div class="habit-checkbox mr-3" id="habit-water"></div>
                                    <div>
                                        <div class="font-medium text-glass-primary">Hidrataci√≥n</div>
                                        <div class="text-xs text-glass-secondary">8 vasos de agua</div>
                                    </div>
                                </div>
                                <div class="text-sm text-emerald-300">+1 energ√≠a</div>
                            </div>
                            
                            <!-- H√°bito 4: Conexi√≥n Social -->
                            <div class="flex items-center justify-between p-3 glass-light rounded-lg">
                                <div class="flex items-center">
                                    <div class="habit-checkbox mr-3" id="habit-social"></div>
                                    <div>
                                        <div class="font-medium text-glass-primary">Conexi√≥n Social</div>
                                        <div class="text-xs text-glass-secondary">Contacto humano</div>
                                    </div>
                                </div>
                                <div class="text-sm text-emerald-300">+2 bienestar</div>
                            </div>
                        </div>
                        
                        <!-- Progreso Semanal -->
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-glass-primary">Progreso Semanal</span>
                                <span id="habits-progress" class="text-glass-primary">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div id="habits-progress-bar" class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card 3: Autocompasi√≥n -->
                    <div class="card glass-border p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 icon-glass flex items-center justify-center mr-3">
                                <i class="fas fa-hands-heart text-glass-primary"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-glass-primary">Autocompasi√≥n ‚ù§Ô∏è</h2>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-bold text-glass-primary mb-2">Diario de Gratitud:</h4>
                            <textarea id="gratitude-journal" rows="3" placeholder="3 cosas por las que estoy agradecido hoy..." class="glass-textarea w-full"></textarea>
                            <button id="save-gratitude" class="btn-primary w-full mt-2 py-2 click-sound">
                                <i class="far fa-heart mr-2"></i>
                                Guardar Gratitud
                            </button>
                        </div>
                        
                        <!-- Ejercicios de Autocompasi√≥n -->
                        <div>
                            <h4 class="font-bold text-glass-primary mb-2">Ejercicios R√°pidos:</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <button class="compassion-exercise p-2 glass-light rounded-lg text-sm click-sound" data-exercise="selfTalk">
                                    <i class="fas fa-comment-medical mr-1"></i>
                                    Di√°logo Interno Amoroso
                                </button>
                                <button class="compassion-exercise p-2 glass-light rounded-lg text-sm click-sound" data-exercise="handOnHeart">
                                    <i class="fas fa-hand-holding-heart mr-1"></i>
                                    Mano en el Coraz√≥n
                                </button>
                                <button class="compassion-exercise p-2 glass-light rounded-lg text-sm click-sound" data-exercise="forgiveness">
                                    <i class="fas fa-dove mr-1"></i>
                                    Perd√≥n Personal
                                </button>
                                <button class="compassion-exercise p-2 glass-light rounded-lg text-sm click-sound" data-exercise="commonHumanity">
                                    <i class="fas fa-users mr-1"></i>
                                    Humanidad Compartida
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Center Column -->
                <div class="space-y-6">
                    
                    <!-- Card 4: Respira conmigo -->
                    <div class="card glass-border p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 icon-glass flex items-center justify-center mr-3">
                                <i class="fas fa-lungs text-glass-primary"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-glass-primary">Respira conmigo üå¨Ô∏è</h2>
                        </div>
                        
                        <p class="text-glass-primary mb-6">M√©todo Wim Hof: 30 respiraciones profundas (4s inhalar / 7s exhalar) + retenci√≥n</p>
                        
                        <!-- Instrucci√≥n mejorada -->
                        <div class="mb-4 p-3 glass-light rounded-lg">
                            <p class="text-sm text-blue-200">
                                <i class="fas fa-info-circle mr-2"></i>
                                La voz guiada te ayudar√° paso a paso. Rel√°jate y sigue las instrucciones.
                            </p>
                        </div>
                        
                        <div class="breathing-balloon-container">
                            <div class="breathing-balloon" id="breathing-balloon">
                                <div class="balloon-string"></div>
                                <div class="balloon-knot"></div>
                                <div class="breathing-instruction text-center">
                                    <div id="breath-phase" class="text-glass-primary">LISTO</div>
                                    <div id="breath-cycle-display" class="text-3xl font-bold mt-2 text-white">0/30</div>
                                </div>
                            </div>
                            
                            <!-- Contador de ciclo al costado derecho -->
                            <div class="cycle-counter">
                                <div class="cycle-box glass-light">
                                    <div class="text-xs text-glass-secondary mb-1">Ciclo</div>
                                    <div id="breath-cycle" class="text-2xl font-bold text-white">0</div>
                                    <div class="text-xs text-glass-secondary">/30</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-center space-x-4 mb-6 mt-12">
                            <button id="start-breathing" class="btn-primary px-6 py-2 click-sound">
                                <i class="fas fa-play mr-2"></i> Comenzar
                            </button>
                            <button id="stop-breathing" class="px-6 py-2 glass-light rounded-lg click-sound text-glass-primary">
                                <i class="fas fa-stop mr-2"></i> Detener
                            </button>
                            <button id="reset-breathing" class="px-6 py-2 glass-light rounded-lg click-sound text-glass-primary">
                                <i class="fas fa-redo mr-2"></i> Reiniciar
                            </button>
                        </div>
                        
                        <!-- Gu√≠a de voz mejorada -->
                        <div class="voice-guidance">
                            <h4 class="font-bold text-glass-primary mb-2">Gu√≠a de Voz üó£Ô∏è</h4>
                            <p class="text-sm text-glass-secondary mb-3">Voz femenina para guiarte en la t√©cnica</p>
                            
                            <div id="voice-status" class="voice-status">
                                <i class="fas fa-volume-up"></i>
                                <span id="current-instruction" class="text-glass-primary">Presiona "Comenzar" para iniciar</span>
                            </div>
                            
                            <div class="voice-controls">
                                <button id="toggle-voice" class="voice-btn text-glass-primary">
                                    <i class="fas fa-volume-up"></i>
                                    <span>Activar Voz</span>
                                </button>
                                <button id="test-voice" class="voice-btn text-glass-primary">
                                    <i class="fas fa-play"></i>
                                    <span>Probar Voz</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Ejercicios de Grounding con voz -->
                        <div class="bg-blue-500/10 p-4 rounded-xl mt-4 glass-light">
                            <h4 class="font-bold text-blue-200 mb-2">T√©cnica 5-4-3-2-1 (Grounding):</h4>
                            <div id="grounding-exercise" class="space-y-3">
                                <div class="grounding-step" id="grounding-step-1">
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 icon-glass flex items-center justify-center mr-3">
                                            <span class="text-blue-300 font-bold">5</span>
                                        </div>
                                        <span class="text-glass-primary">5 cosas que puedes VER</span>
                                    </div>
                                </div>
                                <div class="grounding-step" id="grounding-step-2">
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 icon-glass flex items-center justify-center mr-3">
                                            <span class="text-blue-300 font-bold">4</span>
                                        </div>
                                        <span class="text-glass-primary">4 cosas que puedes TOCAR</span>
                                    </div>
                                </div>
                                <div class="grounding-step" id="grounding-step-3">
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 icon-glass flex items-center justify-center mr-3">
                                            <span class="text-blue-300 font-bold">3</span>
                                        </div>
                                        <span class="text-glass-primary">3 cosas que puedes OIR</span>
                                    </div>
                                </div>
                                <div class="grounding-step" id="grounding-step-4">
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 icon-glass flex items-center justify-center mr-3">
                                            <span class="text-blue-300 font-bold">2</span>
                                        </div>
                                        <span class="text-glass-primary">2 cosas que puedes OLER</span>
                                    </div>
                                </div>
                                <div class="grounding-step" id="grounding-step-5">
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 icon-glass flex items-center justify-center mr-3">
                                            <span class="text-blue-300 font-bold">1</span>
                                        </div>
                                        <span class="text-glass-primary">1 cosa que puedes SABOREAR</span>
                                    </div>
                                </div>
                            </div>
                            <button id="start-grounding" class="btn-primary w-full mt-3 py-2 click-sound">
                                <i class="fas fa-play-circle mr-2"></i>
                                Iniciar Grounding con Voz
                            </button>
                        </div>
                    </div>
                    
                    <!-- Card 5: Higiene del Sue√±o -->
                    <div class="card sleep-card p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 icon-glass flex items-center justify-center mr-3">
                                <i class="fas fa-moon text-blue-300"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-glass-primary">Higiene del Sue√±o üåô</h2>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-bold text-glass-primary mb-2">Calidad de Sue√±o Anoche:</h4>
                            <div class="flex space-x-2 mb-3">
                                <button class="sleep-quality px-3 py-2 rounded-lg glass-light click-sound text-glass-primary" data-quality="1">üò¥ 1</button>
                                <button class="sleep-quality px-3 py-2 rounded-lg glass-light click-sound text-glass-primary" data-quality="2">üò™ 2</button>
                                <button class="sleep-quality px-3 py-2 rounded-lg glass-light click-sound text-glass-primary" data-quality="3">üòê 3</button>
                                <button class="sleep-quality px-3 py-2 rounded-lg glass-light click-sound text-glass-primary" data-quality="4">üòä 4</button>
                                <button class="sleep-quality px-3 py-2 rounded-lg glass-light click-sound text-glass-primary" data-quality="5">üòÅ 5</button>
                            </div>
                        </div>
                        
                        <!-- Rutina Pre-Sue√±o -->
                        <div class="mb-4">
                            <h4 class="font-bold text-glass-primary mb-2">Rutina Pre-Sue√±o (10 min):</h4>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="checkbox" id="sleep-routine-1" class="glass-checkbox mr-3">
                                    <label for="sleep-routine-1" class="text-sm text-glass-primary">Apagar pantallas 1h antes</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="sleep-routine-2" class="glass-checkbox mr-3">
                                    <label for="sleep-routine-2" class="text-sm text-glass-primary">Lectura ligera 10 min</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="sleep-routine-3" class="glass-checkbox mr-3">
                                    <label for="sleep-routine-3" class="text-sm text-glass-primary">Respiraci√≥n 4-7-8</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="sleep-routine-4" class="glass-checkbox mr-3">
                                    <label for="sleep-routine-4" class="text-sm text-glass-primary">Temperatura fresca</label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Secci√≥n de Ambiente -->
                        <div class="ambient-sounds">
                            <h4 class="font-bold text-glass-primary mb-2">Ambiente Relajante:</h4>
                            <p class="text-sm text-glass-secondary mb-2">Cierra los ojos e imagina estos escenarios:</p>
                            <div class="sound-item click-sound" data-scenario="playa">
                                <i class="fas fa-umbrella-beach text-blue-300"></i>
                                <span class="text-glass-primary">Playa al atardecer</span>
                            </div>
                            <div class="sound-item click-sound" data-scenario="bosque">
                                <i class="fas fa-tree text-green-300"></i>
                                <span class="text-glass-primary">Bosque tranquilo</span>
                            </div>
                            <div class="sound-item click-sound" data-scenario="lluvia">
                                <i class="fas fa-cloud-rain text-gray-300"></i>
                                <span class="text-glass-primary">Lluvia suave</span>
                            </div>
                            <div class="sound-item click-sound" data-scenario="cascada">
                                <i class="fas fa-water text-cyan-300"></i>
                                <span class="text-glass-primary">Cascada de monta√±a</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card 6: Tu Progreso y Estad√≠sticas -->
                    <div class="card pattern-card p-6">
                        <div class="flex items-center mb-6">
                            <div class="w-10 h-10 icon-glass flex items-center justify-center mr-3">
                                <i class="fas fa-chart-line text-blue-300"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-glass-primary">Tu Progreso y Estad√≠sticas üìä</h2>
                        </div>
                        
                        <!-- Pesta√±as de Periodo -->
                        <div class="flex mb-6 border-b border-white/20">
                            <button class="stats-period-btn px-4 py-2 font-medium text-glass-primary hover:text-white transition border-b-2 border-transparent hover:border-white/40 active" data-period="diario">
                                Diario
                            </button>
                            <button class="stats-period-btn px-4 py-2 font-medium text-glass-primary hover:text-white transition border-b-2 border-transparent hover:border-white/40" data-period="semanal">
                                Semanal
                            </button>
                            <button class="stats-period-btn px-4 py-2 font-medium text-glass-primary hover:text-white transition border-b-2 border-transparent hover:border-white/40" data-period="mensual">
                                Mensual
                            </button>
                            <button class="stats-period-btn px-4 py-2 font-medium text-glass-primary hover:text-white transition border-b-2 border-transparent hover:border-white/40" data-period="anual">
                                Anual
                            </button>
                        </div>
                        
                        <!-- Estad√≠sticas Din√°micas -->
                        <div id="stats-content" class="stats-container glass-scrollbar">
                            <!-- Contenido se carga din√°micamente -->
                        </div>
                        
                        <!-- Gr√°fico de Progreso -->
                        <div class="mt-6">
                            <h3 class="font-bold text-glass-primary mb-3">Evoluci√≥n del Bienestar</h3>
                            <div class="chart-container">
                                <canvas id="wellness-chart" height="150"></canvas>
                            </div>
                        </div>
                        
                        <!-- Evaluaci√≥n PSS-10 -->
                        <div class="ai-analysis-box mt-6">
                            <h3 class="font-bold text-blue-200 mb-3">Evaluaci√≥n PSS-10 üß™</h3>
                            <p class="text-sm text-blue-300 mb-3">Escala de Estr√©s Percibido (validada cl√≠nicamente)</p>
                            <div class="flex gap-2">
                                <button id="start-pss-assessment" class="btn-primary flex-1 py-2 click-sound">
                                    <i class="fas fa-clipboard-check mr-2"></i>
                                    Realizar Evaluaci√≥n
                                </button>
                                <button id="view-pss-results" class="btn-therapy flex-1 py-2 click-sound">
                                    <i class="fas fa-chart-bar mr-2"></i>
                                    Ver Resultados
                                </button>
                            </div>
                            <div id="pss-assessment-result" class="mt-3 p-3 glass-light rounded-lg text-sm hidden">
                                <!-- Resultados PSS-10 aparecer√°n aqu√≠ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column -->
                <div class="space-y-6">
                    
                    <!-- Card 7: Terapeuta CBT con ChatGPT -->
                    <div class="card therapy-chat p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 icon-glass flex items-center justify-center mr-3">
                                <i class="fas fa-robot text-purple-300"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-glass-primary">Terapeuta CBT ü§ñ</h2>
                        </div>
                        
                        <p class="text-glass-primary mb-4">Habla con nuestro asistente basado en ChatGPT</p>
                        
                        <div id="therapy-chat-container" class="h-64 overflow-y-auto mb-4 p-3 glass-light rounded-lg glass-scrollbar">
                            <div class="therapy-message therapist-message fade-in">
                                <p class="text-glass-primary">¬°Hola! Soy tu asistente de terapia basado en ChatGPT. Estoy aqu√≠ para ayudarte con t√©cnicas de Terapia Cognitivo-Conductual. ¬øEn qu√© puedo ayudarte hoy?</p>
                            </div>
                        </div>
                        
                        <!-- Loading indicator -->
                        <div id="chatgpt-loading" class="chatgpt-loading hidden">
                            <i class="fas fa-spinner mr-2 animate-spin"></i>
                            <span class="text-purple-300">ChatGPT est√° pensando...</span>
                        </div>
                        
                        <div class="flex">
                            <input type="text" id="therapy-input" placeholder="Escribe lo que sientes o preg√∫ntame algo..." class="glass-input flex-grow rounded-l-lg">
                            <button id="therapy-send" class="btn-therapy px-4 rounded-r-lg click-sound">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        
                        <!-- T√©cnicas CBT R√°pidas -->
                        <div class="mt-4 grid grid-cols-2 gap-2">
                            <button class="cbt-technique p-2 glass-light rounded-lg text-sm click-sound text-glass-primary" data-technique="thoughtRecord">
                                <i class="fas fa-clipboard-list mr-1"></i>
                                Registro de Pensamientos
                            </button>
                            <button class="cbt-technique p-2 glass-light rounded-lg text-sm click-sound text-glass-primary" data-technique="cognitiveRestructuring">
                                <i class="fas fa-exchange-alt mr-1"></i>
                                Reestructuraci√≥n
                            </button>
                            <button class="cbt-technique p-2 glass-light rounded-lg text-sm click-sound text-glass-primary" data-technique="evidenceForAgainst">
                                <i class="fas fa-balance-scale mr-1"></i>
                                Evidencia a favor/en contra
                            </button>
                            <button class="cbt-technique p-2 glass-light rounded-lg text-sm click-sound text-glass-primary" data-technique="behavioralActivation">
                                <i class="fas fa-running mr-1"></i>
                                Activaci√≥n Conductual
                            </button>
                        </div>
                    </div>
                    
                    <!-- Card 8: Ayuda Profesional -->
                    <div class="card p-6 glass-border">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 icon-glass flex items-center justify-center mr-3">
                                <i class="fas fa-hands-helping text-purple-300"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-glass-primary">Ayuda Profesional ü§ù</h2>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- Gu√≠a para buscar terapeuta -->
                            <div class="p-3 glass-light rounded-lg">
                                <h4 class="font-bold text-purple-200 mb-2">C√≥mo elegir un terapeuta:</h4>
                                <ul class="text-sm text-purple-300 space-y-1 list-disc pl-4">
                                    <li>Busca especializaci√≥n en tu necesidad</li>
                                    <li>Consulta primeras sesiones de prueba</li>
                                    <li>Verifica credenciales y licencias</li>
                                    <li>Conf√≠a en tu intuici√≥n sobre la conexi√≥n</li>
                                </ul>
                            </div>
                            
                            <!-- Tipos de terapia -->
                            <div>
                                <h4 class="font-bold text-glass-primary mb-2">Tipos de Terapia:</h4>
                                <div class="grid grid-cols-2 gap-2">
                                    <div class="p-2 glass-light rounded-lg">
                                        <div class="font-medium text-sm text-glass-primary">CBT</div>
                                        <div class="text-xs text-glass-secondary">Pensamientos-Conductas</div>
                                    </div>
                                    <div class="p-2 glass-light rounded-lg">
                                        <div class="font-medium text-sm text-glass-primary">DBT</div>
                                        <div class="text-xs text-glass-secondary">Regulaci√≥n Emocional</div>
                                    </div>
                                    <div class="p-2 glass-light rounded-lg">
                                        <div class="font-medium text-sm text-glass-primary">ACT</div>
                                        <div class="text-xs text-glass-secondary">Aceptaci√≥n-Compromiso</div>
                                    </div>
                                    <div class="p-2 glass-light rounded-lg">
                                        <div class="font-medium text-sm text-glass-primary">EMDR</div>
                                        <div class="text-xs text-glass-secondary">Trauma</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Preparaci√≥n para terapia -->
                            <div>
                                <h4 class="font-bold text-glass-primary mb-2">Prepara tu primera sesi√≥n:</h4>
                                <textarea id="therapy-prep" rows="2" placeholder="¬øQu√© quieres trabajar? ¬øQu√© s√≠ntomas tienes?..." class="glass-textarea w-full text-sm"></textarea>
                                <button id="save-therapy-prep" class="btn-therapy w-full mt-2 py-2 click-sound">
                                    <i class="fas fa-save mr-2"></i>
                                    Guardar Notas para Terapia
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card 9: Primeros Auxilios Emocionales -->
                    <div class="card crisis-card p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 icon-glass flex items-center justify-center mr-3">
                                <i class="fas fa-first-aid text-red-300"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-glass-primary">Primeros Auxilios Emocionales üöë</h2>
                        </div>
                        
                        <p class="text-glass-primary mb-4">¬øEst√°s en crisis o necesitas ayuda inmediata?</p>
                        
                        <div class="space-y-3 mb-4">
                            <button class="btn-crisis w-full py-3 text-left click-sound" data-crisis="panic">
                                <i class="fas fa-heartbeat mr-2"></i>
                                Ataque de P√°nico/Ansiedad
                            </button>
                            
                            <button class="btn-crisis w-full py-3 text-left click-sound" data-crisis="thoughts">
                                <i class="fas fa-brain mr-2"></i>
                                Pensamientos Negativos Intrusivos
                            </button>
                            
                            <button class="btn-crisis w-full py-3 text-left click-sound" data-crisis="grounding">
                                <i class="fas fa-mountain mr-2"></i>
                                Ejercicios de Grounding
                            </button>
                            
                            <button class="btn-crisis w-full py-3 text-left click-sound" data-crisis="breathing">
                                <i class="fas fa-wind mr-2"></i>
                                Respiraci√≥n de Emergencia
                            </button>
                        </div>
                        
                        <!-- L√≠neas de Ayuda de CHILE Actualizadas -->
                        <div class="mt-4 p-3 glass-light rounded-lg">
                            <h4 class="font-bold text-red-200 mb-2">L√≠neas de Ayuda Chile üá®üá±:</h4>
                            <div class="text-sm space-y-2">
                                <div class="flex justify-between items-center p-2 glass-light rounded">
                                    <span class="font-medium text-red-200">Salud Responde</span>
                                    <span class="font-bold text-white">600 360 7777</span>
                                </div>
                                <div class="flex justify-between items-center p-2 glass-light rounded">
                                    <span class="font-medium text-red-200">Fono Mayor</span>
                                    <span class="font-bold text-white">800 4000 35</span>
                                </div>
                                <div class="flex justify-between items-center p-2 glass-light rounded">
                                    <span class="font-medium text-red-200">Fono Infancia</span>
                                    <span class="font-bold text-white">800 200 818</span>
                                </div>
                                <div class="flex justify-between items-center p-2 glass-light rounded">
                                    <span class="font-medium text-red-200">Fono Drogas</span>
                                    <span class="font-bold text-white">1412</span>
                                </div>
                                <div class="flex justify-between items-center p-2 glass-light rounded">
                                    <span class="font-medium text-red-200">Emergencias M√©dicas</span>
                                    <span class="font-bold text-white">131</span>
                                </div>
                                <div class="flex justify-between items-center p-2 glass-light rounded">
                                    <span class="font-medium text-red-200">Carabineros</span>
                                    <span class="font-bold text-white">133</span>
                                </div>
                                <div class="flex justify-between items-center p-2 glass-light rounded">
                                    <span class="font-medium text-red-200">Ambulancia</span>
                                    <span class="font-bold text-white">131</span>
                                </div>
                                <div class="flex justify-between items-center p-2 glass-light rounded">
                                    <span class="font-medium text-red-200">Bomberos</span>
                                    <span class="font-bold text-white">132</span>
                                </div>
                            </div>
                            <div class="mt-3 p-2 bg-yellow-500/10 rounded border border-yellow-500/20">
                                <p class="text-xs text-yellow-200">
                                    <i class="fas fa-exclamation-triangle mr-1"></i>
                                    <strong>Importante:</strong> En caso de riesgo vital, llama inmediatamente al <strong class="text-white">131</strong> o acude al servicio de urgencia m√°s cercano.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <footer class="mt-10 pt-6 border-t border-white/20 text-center">
                <p class="text-glass-primary">CalmApp - Herramientas basadas en evidencia para tu salud mental <span class="text-red-300">‚ù§Ô∏è</span></p>
                <p class="text-sm text-glass-secondary mt-2">Esta aplicaci√≥n no sustituye atenci√≥n profesional. En crisis, contacta servicios de emergencia.</p>
                <p class="text-xs text-purple-300 mt-1"><i class="fas fa-shield-alt mr-1"></i> Todos tus datos son privados y seguros</p>
                <div class="mt-3">
                    <button id="export-data" class="btn-success px-4 py-2 click-sound">
                        <i class="fas fa-download mr-2"></i>Exportar Mis Datos
                    </button>
                    <button id="clear-data" class="btn-crisis px-4 py-2 ml-2 click-sound">
                        <i class="fas fa-trash mr-2"></i>Borrar Datos
                    </button>
                </div>
            </footer>
        </div>
    </div>

    <!-- Modal de Crisis -->
    <div id="crisis-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div class="modal-glass rounded-xl p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto relative z-10">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-glass-primary" id="crisis-modal-title"></h3>
                <button id="close-crisis-modal" class="text-glass-secondary hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="crisis-modal-content" class="space-y-4">
                <!-- El contenido se cargar√° din√°micamente -->
            </div>
            
            <div class="mt-6">
                <button id="crisis-modal-action" class="btn-crisis w-full py-3 click-sound">
                    <i class="fas fa-play mr-2"></i>
                    Comenzar Ejercicio
                </button>
            </div>
        </div>
    </div>

    <!-- Modal PSS-10 Assessment -->
    <div id="pss-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div class="modal-glass rounded-xl p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto relative z-10">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-glass-primary">Evaluaci√≥n PSS-10 (Estr√©s Percibido)</h3>
                <button id="close-pss-modal" class="text-glass-secondary hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="pss-questions" class="space-y-6">
                <!-- Las preguntas se cargar√°n din√°micamente -->
            </div>
            
            <div class="mt-6 flex justify-between">
                <button id="prev-pss-question" class="px-4 py-2 glass-light rounded-lg click-sound text-glass-primary hidden">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Anterior
                </button>
                <button id="next-pss-question" class="btn-primary px-6 py-2 click-sound">
                    Siguiente
                    <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Estad√≠sticas Detalladas -->
    <div id="stats-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div class="modal-glass rounded-xl p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto relative z-10">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-glass-primary" id="stats-modal-title">Estad√≠sticas Detalladas</h3>
                <button id="close-stats-modal" class="text-glass-secondary hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="stats-modal-content">
                <!-- Contenido se carga din√°micamente -->
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // App State
        const appState = {
            currentUser: { name: "Usuario", email: "bienestar@calmapp.com" },
            currentMood: 'neutral',
            moodIntensity: 5,
            breathingActive: false,
            breathPhase: 'ready',
            breathCount: 0,
            maxBreaths: 30,
            savedJournals: [],
            moodHistory: [],
            therapyChat: [
                {
                    role: 'therapist',
                    content: '¬°Hola! Soy tu asistente de terapia basado en ChatGPT. Estoy aqu√≠ para ayudarte con t√©cnicas de Terapia Cognitivo-Conductual. ¬øEn qu√© puedo ayudarte hoy?'
                }
            ],
            sessionStartTime: null,
            sessionTimer: null,
            savedMeditations: [],
            studyParticipation: false,
            breathInterval: null,
            currentBreathTime: 0,
            sleepQuality: null,
            habits: {
                exercise: false,
                meditation: false,
                water: false,
                social: false
            },
            pssScore: null,
            lastPssDate: null,
            patterns: [],
            gratitudeEntries: [],
            therapyPrepNotes: '',
            crisisHistory: [],
            voiceEnabled: true,
            currentVoiceUtterance: null,
            chatGPTAPIKey: 'demo-key',
            activeScenario: null,
            breathingTimer: null,
            currentBreathingStep: 'ready',
            activityLog: [],
            wellnessScores: [],
            pssAssessments: [],
            appUsage: {
                daily: {},
                weekly: {},
                monthly: {},
                yearly: {}
            },
            statistics: {
                daily: {},
                weekly: {},
                monthly: {},
                yearly: {}
            }
        };

        // Mood configuration with numeric values for stats
        const moodConfig = {
            excelente: { color: 'rgba(16, 185, 129, 0.8)', bgColor: 'rgba(16, 185, 129, 0.1)', value: 5 },
            bien: { color: 'rgba(52, 211, 153, 0.8)', bgColor: 'rgba(52, 211, 153, 0.1)', value: 4 },
            neutral: { color: 'rgba(251, 191, 36, 0.8)', bgColor: 'rgba(251, 191, 36, 0.1)', value: 3 },
            ansioso: { color: 'rgba(245, 158, 11, 0.8)', bgColor: 'rgba(245, 158, 11, 0.1)', value: 2 },
            estresado: { color: 'rgba(249, 115, 22, 0.8)', bgColor: 'rgba(249, 115, 22, 0.1)', value: 2 },
            triste: { color: 'rgba(139, 92, 246, 0.8)', bgColor: 'rgba(139, 92, 246, 0.1)', value: 1 }
        };

        // PSS-10 Questions (Perceived Stress Scale)
        const pssQuestions = [
            {
                id: 1,
                question: "¬øEn el √∫ltimo mes, con qu√© frecuencia te has sentido alterado por algo que ha ocurrido inesperadamente?",
                options: [
                    { value: 0, text: "Nunca" },
                    { value: 1, text: "Casi nunca" },
                    { value: 2, text: "De vez en cuando" },
                    { value: 3, text: "A menudo" },
                    { value: 4, text: "Muy a menudo" }
                ]
            },
            {
                id: 2,
                question: "¬øEn el √∫ltimo mes, con qu√© frecuencia te has sentido incapaz de controlar las cosas importantes en tu vida?",
                options: [
                    { value: 0, text: "Nunca" },
                    { value: 1, text: "Casi nunca" },
                    { value: 2, text: "De vez en cuando" },
                    { value: 3, text: "A menudo" },
                    { value: 4, text: "Muy a menudo" }
                ]
            },
            {
                id: 3,
                question: "¬øEn el √∫ltimo mes, con qu√© frecuencia te has sentido nervioso o estresado?",
                options: [
                    { value: 0, text: "Nunca" },
                    { value: 1, text: "Casi nunca" },
                    { value: 2, text: "De vez en cuando" },
                    { value: 3, text: "A menudo" },
                    { value: 4, text: "Muy a menudo" }
                ]
            },
            {
                id: 4,
                question: "¬øEn el √∫ltimo mes, con qu√© frecuencia has manejado con √©xito los peque√±os problemas irritantes?",
                options: [
                    { value: 4, text: "Muy a menudo" },
                    { value: 3, text: "A menudo" },
                    { value: 2, text: "De vez en cuando" },
                    { value: 1, text: "Casi nunca" },
                    { value: 0, text: "Nunca" }
                ]
            },
            {
                id: 5,
                question: "¬øEn el √∫ltimo mes, con qu√© frecuencia te has sentido que ibas bien en el cumplimiento de las tareas?",
                options: [
                    { value: 4, text: "Muy a menudo" },
                    { value: 3, text: "A menudo" },
                    { value: 2, text: "De vez en cuando" },
                    { value: 1, text: "Casi nunca" },
                    { value: 0, text: "Nunca" }
                ]
            },
            {
                id: 6,
                question: "¬øEn el √∫ltimo mes, con qu√© frecuencia te has sentido seguro de tu capacidad para manejar tus problemas personales?",
                options: [
                    { value: 4, text: "Muy a menudo" },
                    { value: 3, text: "A menudo" },
                    { value: 2, text: "De vez en cuando" },
                    { value: 1, text: "Casi nunca" },
                    { value: 0, text: "Nunca" }
                ]
            },
            {
                id: 7,
                question: "¬øEn el √∫ltimo mes, con qu√© frecuencia has sentido que las cosas te iban bien?",
                options: [
                    { value: 4, text: "Muy a menudo" },
                    { value: 3, text: "A menudo" },
                    { value: 2, text: "De vez en cuando" },
                    { value: 1, text: "Casi nunca" },
                    { value: 0, text: "Nunca" }
                ]
            },
            {
                id: 8,
                question: "¬øEn el √∫ltimo mes, con qu√© frecuencia te has sentido que no pod√≠as afrontar todas las cosas que ten√≠as que hacer?",
                options: [
                    { value: 0, text: "Nunca" },
                    { value: 1, text: "Casi nunca" },
                    { value: 2, text: "De vez en cuando" },
                    { value: 3, text: "A menudo" },
                    { value: 4, text: "Muy a menudo" }
                ]
            },
            {
                id: 9,
                question: "¬øEn el √∫ltimo mes, con qu√© frecuencia te has sentido capaz de controlar las dificultades de tu vida?",
                options: [
                    { value: 4, text: "Muy a menudo" },
                    { value: 3, text: "A menudo" },
                    { value: 2, text: "De vez en cuando" },
                    { value: 1, text: "Casi nunca" },
                    { value: 0, text: "Nunca" }
                ]
            },
            {
                id: 10,
                question: "¬øEn el √∫ltimo mes, con qu√© frecuencia te has sentido tan enfadado que no pod√≠as quedarte sentado?",
                options: [
                    { value: 0, text: "Nunca" },
                    { value: 1, text: "Casi nunca" },
                    { value: 2, text: "De vez en cuando" },
                    { value: 3, text: "A menudo" },
                    { value: 4, text: "Muy a menudo" }
                ]
            }
        ];

        let currentPssQuestion = 0;
        let pssAnswers = [];

        // Text-to-Speech Function
        function speakText(text, rate = 0.9, pitch = 1.1) {
            if (!appState.voiceEnabled) return;
            
            // Cancel any ongoing speech
            if (appState.currentVoiceUtterance) {
                window.speechSynthesis.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-ES';
            utterance.rate = rate;
            utterance.pitch = pitch;
            
            // Try to set a female voice
            const voices = window.speechSynthesis.getVoices();
            const femaleVoice = voices.find(voice => 
                voice.lang.includes('es') && 
                (voice.name.includes('Female') || voice.name.includes('Mujer') || voice.name.includes('woman'))
            );
            
            if (femaleVoice) {
                utterance.voice = femaleVoice;
            } else if (voices.length > 0) {
                // Use the first Spanish voice available
                const spanishVoice = voices.find(voice => voice.lang.includes('es'));
                if (spanishVoice) {
                    utterance.voice = spanishVoice;
                }
            }
            
            utterance.onstart = () => {
                console.log('Voice started:', text);
            };
            
            utterance.onend = () => {
                appState.currentVoiceUtterance = null;
            };
            
            appState.currentVoiceUtterance = utterance;
            window.speechSynthesis.speak(utterance);
        }

        // Initialize App
        function initApp() {
            // Set current date
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('es-ES', options);
            
            // Start session timer
            startSessionTimer();
            
            // Load user data
            loadUserData();
            
            // Generate initial statistics
            generateInitialStatistics();
            
            // Set initial mood
            setActiveMood('neutral');
            
            // Setup event listeners
            setupAppEventListeners();
            
            // Update dashboard
            updateDashboard();
            
            // Update statistics
            updateStatisticsDisplay('diario');
            
            // Initialize Chart.js
            initWellnessChart();
            
            // Initialize speech synthesis voices
            if ('speechSynthesis' in window) {
                // Force voices to load
                window.speechSynthesis.getVoices();
                setTimeout(() => {
                    console.log('Speech synthesis voices loaded');
                }, 1000);
            }
            
            console.log('CalmApp Glassmorphism iniciada');
        }

        function setupAppEventListeners() {
            // Mood buttons
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    playClickSound();
                    const mood = this.getAttribute('data-mood');
                    setActiveMood(mood);
                });
            });
            
            // Mood intensity slider
            const intensitySlider = document.getElementById('mood-intensity');
            const intensityValue = document.getElementById('intensity-value');
            intensitySlider.addEventListener('input', function() {
                intensityValue.textContent = this.value;
                appState.moodIntensity = parseInt(this.value);
            });
            
            // Save mood button
            document.getElementById('save-mood-btn').addEventListener('click', () => {
                playClickSound();
                saveMoodEntry();
            });
            
            // Crisis buttons
            document.querySelectorAll('.btn-crisis').forEach(btn => {
                btn.addEventListener('click', function() {
                    playClickSound();
                    const crisisType = this.getAttribute('data-crisis');
                    openCrisisModal(crisisType);
                });
            });
            
            // Emergency button
            document.getElementById('emergency-btn').addEventListener('click', () => {
                playClickSound();
                openCrisisModal('panic');
            });
            
            // Therapy chat
            document.getElementById('therapy-send').addEventListener('click', sendTherapyMessage);
            document.getElementById('therapy-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendTherapyMessage();
            });
            
            // CBT techniques
            document.querySelectorAll('.cbt-technique').forEach(btn => {
                btn.addEventListener('click', function() {
                    playClickSound();
                    const technique = this.getAttribute('data-technique');
                    startCBTTechnique(technique);
                });
            });
            
            // Sleep quality
            document.querySelectorAll('.sleep-quality').forEach(btn => {
                btn.addEventListener('click', function() {
                    playClickSound();
                    const quality = parseInt(this.getAttribute('data-quality'));
                    recordSleepQuality(quality);
                });
            });
            
            // Ambient sound scenarios
            document.querySelectorAll('.sound-item').forEach(item => {
                item.addEventListener('click', function() {
                    playClickSound();
                    const scenario = this.getAttribute('data-scenario');
                    activateScenario(scenario);
                });
            });
            
            // Breathing exercises
            document.getElementById('start-breathing').addEventListener('click', startWimHofBreathing);
            document.getElementById('stop-breathing').addEventListener('click', stopWimHofBreathing);
            document.getElementById('reset-breathing').addEventListener('click', resetBreathing);
            
            // Voice controls
            document.getElementById('toggle-voice').addEventListener('click', toggleVoice);
            document.getElementById('test-voice').addEventListener('click', testVoice);
            
            // Grounding exercise
            document.getElementById('start-grounding').addEventListener('click', startGroundingExercise);
            
            // Gratitude journal
            document.getElementById('save-gratitude').addEventListener('click', saveGratitudeEntry);
            
            // Compassion exercises
            document.querySelectorAll('.compassion-exercise').forEach(btn => {
                btn.addEventListener('click', function() {
                    playClickSound();
                    const exercise = this.getAttribute('data-exercise');
                    startCompassionExercise(exercise);
                });
            });
            
            // PSS assessment buttons
            document.getElementById('start-pss-assessment').addEventListener('click', startPSSAssessment);
            document.getElementById('participate-study-btn').addEventListener('click', startPSSAssessment);
            document.getElementById('view-pss-results').addEventListener('click', showPSSResults);
            
            // Habits checkboxes
            document.querySelectorAll('.habit-checkbox').forEach(checkbox => {
                checkbox.addEventListener('click', function() {
                    playClickSound();
                    const habitId = this.id.replace('habit-', '');
                    toggleHabit(habitId);
                });
            });
            
            // Sleep routine checkboxes
            document.querySelectorAll('.glass-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    playClickSound();
                    logAppUsage('sleep_routine', 'checkbox_toggle');
                });
            });
            
            // Therapy prep notes
            document.getElementById('save-therapy-prep').addEventListener('click', saveTherapyPrepNotes);
            
            // Modal close buttons
            document.getElementById('close-crisis-modal').addEventListener('click', closeCrisisModal);
            document.getElementById('close-pss-modal').addEventListener('click', closePSSModal);
            document.getElementById('close-stats-modal').addEventListener('click', closeStatsModal);
            
            // Statistics period buttons
            document.querySelectorAll('.stats-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    playClickSound();
                    const period = this.getAttribute('data-period');
                    setActivePeriod(period);
                    updateStatisticsDisplay(period);
                });
            });
            
            // Export and clear data buttons
            document.getElementById('export-data').addEventListener('click', exportUserData);
            document.getElementById('clear-data').addEventListener('click', clearUserData);
            
            // PSS navigation
            document.getElementById('prev-pss-question').addEventListener('click', prevPSSQuestion);
            document.getElementById('next-pss-question').addEventListener('click', nextPSSQuestion);
        }

        function setActiveMood(mood) {
            appState.currentMood = mood;
            
            // Update UI
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.style.background = 'rgba(255, 255, 255, 0.08)';
                btn.style.border = '1px solid rgba(255, 255, 255, 0.15)';
            });
            
            const activeBtn = document.querySelector(`.mood-btn[data-mood="${mood}"]`);
            if (activeBtn) {
                const config = moodConfig[mood];
                activeBtn.style.background = `linear-gradient(135deg, ${config.bgColor}, rgba(255, 255, 255, 0.1))`;
                activeBtn.style.border = `2px solid ${config.color}`;
                activeBtn.style.backdropFilter = 'blur(12px)';
            }
        }

        function logAppUsage(activity, details = '') {
            const logEntry = {
                timestamp: new Date().toISOString(),
                activity: activity,
                details: details,
                date: getCurrentDateKey(),
                week: getCurrentWeekKey(),
                month: getCurrentMonthKey(),
                year: getCurrentYearKey()
            };
            
            appState.activityLog.push(logEntry);
            
            // Update usage statistics
            updateUsageStatistics(logEntry);
            
            // Save to localStorage
            saveUserData();
            
            return logEntry;
        }

        function updateUsageStatistics(logEntry) {
            const { date, week, month, year, activity } = logEntry;
            
            // Initialize if not exists
            if (!appState.appUsage.daily[date]) appState.appUsage.daily[date] = {};
            if (!appState.appUsage.weekly[week]) appState.appUsage.weekly[week] = {};
            if (!appState.appUsage.monthly[month]) appState.appUsage.monthly[month] = {};
            if (!appState.appUsage.yearly[year]) appState.appUsage.yearly[year] = {};
            
            // Increment activity count
            appState.appUsage.daily[date][activity] = (appState.appUsage.daily[date][activity] || 0) + 1;
            appState.appUsage.weekly[week][activity] = (appState.appUsage.weekly[week][activity] || 0) + 1;
            appState.appUsage.monthly[month][activity] = (appState.appUsage.monthly[month][activity] || 0) + 1;
            appState.appUsage.yearly[year][activity] = (appState.appUsage.yearly[year][activity] || 0) + 1;
        }

        function saveMoodEntry() {
            const notes = document.getElementById('mood-notes').value.trim();
            const moodEntry = {
                timestamp: new Date().toISOString(),
                mood: appState.currentMood,
                intensity: appState.moodIntensity,
                notes: notes,
                date: getCurrentDateKey(),
                week: getCurrentWeekKey(),
                month: getCurrentMonthKey(),
                year: getCurrentYearKey()
            };
            
            appState.moodHistory.push(moodEntry);
            
            // Log activity
            logAppUsage('mood_entry', `${appState.currentMood} (${appState.moodIntensity}/10)`);
            
            // Update wellness score
            const moodValue = moodConfig[appState.currentMood].value;
            const intensityFactor = appState.moodIntensity / 10;
            const wellnessImpact = Math.round(moodValue * intensityFactor * 2);
            
            const currentWellness = parseInt(document.getElementById('wellness-score').textContent);
            const newWellness = Math.min(100, Math.max(0, currentWellness + wellnessImpact));
            document.getElementById('wellness-score').textContent = newWellness;
            
            // Save wellness score for statistics
            appState.wellnessScores.push({
                date: getCurrentDateKey(),
                score: newWellness,
                mood: appState.currentMood,
                intensity: appState.moodIntensity
            });
            
            saveUserData();
            
            // Update UI
            document.getElementById('mood-status').textContent = '‚úì Estado de √°nimo guardado';
            document.getElementById('mood-status').style.color = '#10b981';
            
            showNotification('Estado de √°nimo registrado exitosamente', 'success');
            
            // Clear notes after 3 seconds
            setTimeout(() => {
                document.getElementById('mood-status').textContent = '';
                document.getElementById('mood-notes').value = '';
            }, 3000);
            
            // Update statistics
            updateStatistics();
            updateStatisticsDisplay(getActivePeriod());
        }

        function startWimHofBreathing() {
            if (appState.breathingActive) return;
            
            appState.breathingActive = true;
            appState.breathCount = 0;
            appState.currentBreathingStep = 'inhale';
            
            // Log activity
            logAppUsage('breathing_exercise', 'wim_hof_start');
            
            const balloon = document.getElementById('breathing-balloon');
            const phaseText = document.getElementById('breath-phase');
            const cycleDisplay = document.getElementById('breath-cycle-display');
            const cycleText = document.getElementById('breath-cycle');
            const voiceStatus = document.getElementById('current-instruction');
            
            balloon.classList.remove('inhaling', 'exhaling', 'holding');
            
            // Start voice guidance
            speakText("Vamos a comenzar la t√©cnica de respiraci√≥n Wim Hof. Si√©ntate c√≥modamente con la espalda recta.");
            
            voiceStatus.textContent = "Preparaci√≥n: Si√©ntate c√≥modamente";
            phaseText.textContent = "PREPARADO";
            cycleDisplay.textContent = "0/30";
            cycleText.textContent = "0";
            
            // Start the breathing cycle after 3 seconds
            setTimeout(() => {
                if (!appState.breathingActive) return;
                breatheCycle();
            }, 3000);

            function breatheCycle() {
                if (!appState.breathingActive || appState.breathCount >= appState.maxBreaths) {
                    if (appState.breathCount >= appState.maxBreaths) {
                        startRetentionPhase();
                    }
                    return;
                }

                // Inhale phase - 4 seconds
                appState.currentBreathingStep = 'inhale';
                phaseText.textContent = 'INHALA';
                voiceStatus.textContent = "Inhala profundamente...";
                balloon.classList.remove('exhaling', 'holding');
                balloon.classList.add('inhaling');
                
                speakText("Inhala profundamente por la nariz");

                setTimeout(() => {
                    if (!appState.breathingActive) return;

                    // Exhale phase - 7 seconds
                    appState.currentBreathingStep = 'exhale';
                    phaseText.textContent = 'EXHALA';
                    voiceStatus.textContent = "Exhala suavemente...";
                    balloon.classList.remove('inhaling');
                    balloon.classList.add('exhaling');
                    
                    speakText("Exhala suavemente por la boca");

                    setTimeout(() => {
                        if (!appState.breathingActive) return;
                        
                        appState.breathCount++;
                        cycleText.textContent = appState.breathCount;
                        cycleDisplay.textContent = `${appState.breathCount}/30`;
                        
                        balloon.classList.remove('exhaling');
                        
                        // Log partial completion
                        if (appState.breathCount % 10 === 0) {
                            logAppUsage('breathing_exercise', `wim_hof_${appState.breathCount}_breaths`);
                        }
                        
                        // Update voice status
                        if (appState.breathCount === 10) {
                            voiceStatus.textContent = "¬°Excelente! 10 respiraciones";
                            if (appState.voiceEnabled) {
                                setTimeout(() => speakText("Muy bien, ya llevamos 10 respiraciones. Contin√∫a concentrado."), 500);
                            }
                        } else if (appState.breathCount === 20) {
                            voiceStatus.textContent = "¬°Incre√≠ble! 20 respiraciones";
                            if (appState.voiceEnabled) {
                                setTimeout(() => speakText("Perfecto, 20 respiraciones. Est√°s haciendo muy bien."), 500);
                            }
                        }
                        
                        if (appState.breathCount < appState.maxBreaths) {
                            setTimeout(breatheCycle, 1000);
                        } else {
                            startRetentionPhase();
                        }
                    }, 7000); // 7 seconds exhale
                }, 4000); // 4 seconds inhale
            }
            
            function startRetentionPhase() {
                appState.currentBreathingStep = 'hold';
                phaseText.textContent = 'RETENCI√ìN';
                voiceStatus.textContent = 'Ret√©n la respiraci√≥n...';
                balloon.classList.remove('inhaling', 'exhaling');
                balloon.classList.add('holding');
                
                speakText("Ahora ret√©n la respiraci√≥n. Relaja todo tu cuerpo. Suelta cualquier tensi√≥n.");
                
                let retentionTime = 90;
                const retentionInterval = setInterval(() => {
                    if (!appState.breathingActive) {
                        clearInterval(retentionInterval);
                        return;
                    }
                    
                    retentionTime--;
                    
                    // Voice cues during retention
                    if (retentionTime === 60) {
                        voiceStatus.textContent = "¬°Excelente! 30 segundos de retenci√≥n";
                        if (appState.voiceEnabled) {
                            speakText("Muy bien, ya pas√≥ medio minuto. Contin√∫a relajado.");
                        }
                    } else if (retentionTime === 30) {
                        voiceStatus.textContent = "¬°Fant√°stico! 60 segundos de retenci√≥n";
                        if (appState.voiceEnabled) {
                            speakText("Perfecto, solo 30 segundos m√°s. Est√°s haciendo fenomenal.");
                        }
                    } else if (retentionTime === 15) {
                        voiceStatus.textContent = "Casi termina, prep√°rate";
                        if (appState.voiceEnabled) {
                            speakText("Casi termina, prep√°rate para la respiraci√≥n final.");
                        }
                    }
                    
                    if (retentionTime <= 0) {
                        clearInterval(retentionInterval);
                        finalBreath();
                    }
                }, 1000);
            }
            
            function finalBreath() {
                phaseText.textContent = 'RESPIRACI√ìN FINAL';
                voiceStatus.textContent = 'Respiraci√≥n final...';
                balloon.classList.remove('holding');
                
                speakText("Ahora toma una respiraci√≥n profunda final. Llena completamente tus pulmones. Y ret√©n...");
                
                setTimeout(() => {
                    if (appState.breathingActive) {
                        speakText("Y exhala lentamente. Felicitaciones, has completado la t√©cnica de Wim Hof. Siente la calma en tu cuerpo.");
                        
                        phaseText.textContent = 'COMPLETADO';
                        cycleDisplay.textContent = '¬°COMPLETADO!';
                        voiceStatus.textContent = "¬°T√©cnica completada! Siente la calma";
                        appState.breathingActive = false;
                        balloon.classList.remove('inhaling', 'exhaling', 'holding');
                        
                        // Log completion
                        logAppUsage('breathing_exercise', 'wim_hof_completed');
                        
                        // Update wellness score
                        const wellnessScore = parseInt(document.getElementById('wellness-score').textContent);
                        document.getElementById('wellness-score').textContent = Math.min(100, wellnessScore + 5);
                        
                        showNotification('Ejercicio de respiraci√≥n completado. Bienestar +5', 'success');
                    }
                }, 15000);
            }
            
            showNotification('Iniciando m√©todo Wim Hof con gu√≠a de voz...', 'info');
        }

        function startGroundingExercise() {
            // Log activity
            logAppUsage('grounding_exercise', '5_4_3_2_1_start');
            
            const steps = [
                { number: 5, text: "Busca cinco cosas que puedas ver a tu alrededor. Observa sus colores, formas y detalles." },
                { number: 4, text: "Ahora encuentra cuatro cosas que puedas tocar. Siente su textura, temperatura y peso." },
                { number: 3, text: "Escucha tres sonidos diferentes en tu entorno. Identifica de d√≥nde vienen." },
                { number: 2, text: "Presta atenci√≥n a dos oleres que puedas percibir en este momento." },
                { number: 1, text: "Finalmente, identifica un sabor en tu boca o piensa en tu sabor favorito." }
            ];
            
            let currentStep = 0;
            
            // Reset all steps
            document.querySelectorAll('.grounding-step').forEach(step => {
                step.classList.remove('active');
            });
            
            function nextStep() {
                if (currentStep > 0) {
                    document.getElementById(`grounding-step-${currentStep}`).classList.remove('active');
                }
                
                if (currentStep < steps.length) {
                    document.getElementById(`grounding-step-${currentStep + 1}`).classList.add('active');
                    
                    // Speak the instruction
                    const stepText = steps[currentStep].text;
                    speakText(stepText);
                    
                    // Update voice status
                    document.getElementById('current-instruction').textContent = `Paso ${steps[currentStep].number}: ${steps[currentStep].text.substring(0, 50)}...`;
                    
                    currentStep++;
                    
                    if (currentStep < steps.length) {
                        setTimeout(nextStep, 12000); // 12 seconds per step
                    } else {
                        setTimeout(() => {
                            speakText("Excelente, has completado el ejercicio de grounding. Ahora est√°s m√°s presente y conectado con el momento actual. ¬øC√≥mo te sientes?");
                            
                            // Log completion
                            logAppUsage('grounding_exercise', '5_4_3_2_1_completed');
                            
                            showNotification('Ejercicio de Grounding completado', 'success');
                            document.getElementById('current-instruction').textContent = "Ejercicio completado. ¬øC√≥mo te sientes?";
                            
                            // Reset steps
                            setTimeout(() => {
                                document.querySelectorAll('.grounding-step').forEach(step => {
                                    step.classList.remove('active');
                                });
                            }, 2000);
                        }, 12000);
                    }
                }
            }
            
            showNotification('Iniciando t√©cnica 5-4-3-2-1 para Grounding...', 'info');
            
            speakText("Vamos a comenzar el ejercicio de grounding 5-4-3-2-1. Este ejercicio te ayudar√° a conectar con el presente y reducir la ansiedad. T√≥mate tu tiempo en cada paso.");
            
            setTimeout(() => {
                nextStep();
            }, 4000);
        }

        function toggleHabit(habitId) {
            if (appState.habits.hasOwnProperty(habitId)) {
                appState.habits[habitId] = !appState.habits[habitId];
                const checkbox = document.getElementById(`habit-${habitId}`);
                
                if (appState.habits[habitId]) {
                    checkbox.classList.add('checked');
                    checkbox.innerHTML = '<i class="fas fa-check text-xs"></i>';
                    
                    // Log habit completion
                    logAppUsage('habit_completed', habitId);
                    
                    // Update wellness score
                    const wellnessScore = parseInt(document.getElementById('wellness-score').textContent);
                    document.getElementById('wellness-score').textContent = Math.min(100, wellnessScore + 2);
                    
                    showNotification(`H√°bito "${habitId}" completado. Bienestar +2`, 'success');
                } else {
                    checkbox.classList.remove('checked');
                    checkbox.innerHTML = '';
                    
                    // Log habit removal
                    logAppUsage('habit_removed', habitId);
                }
                
                updateDashboard();
                saveUserData();
            }
        }

        function saveGratitudeEntry() {
            const text = document.getElementById('gratitude-journal').value.trim();
            if (text) {
                appState.gratitudeEntries.push({
                    date: new Date().toISOString(),
                    text: text,
                    timestamp: new Date().toISOString()
                });
                
                // Log activity
                logAppUsage('gratitude_entry', text.substring(0, 50));
                
                saveUserData();
                document.getElementById('gratitude-journal').value = '';
                
                // Update wellness score
                const wellnessScore = parseInt(document.getElementById('wellness-score').textContent);
                document.getElementById('wellness-score').textContent = Math.min(100, wellnessScore + 3);
                
                showNotification('Entrada de gratitud guardada. Bienestar +3', 'success');
            }
        }

        function startPSSAssessment() {
            currentPssQuestion = 0;
            pssAnswers = [];
            
            // Log activity
            logAppUsage('pss_assessment', 'started');
            
            // Show modal
            const modal = document.getElementById('pss-modal');
            modal.classList.remove('hidden');
            
            // Load first question
            loadPSSQuestion();
        }

        function loadPSSQuestion() {
            const container = document.getElementById('pss-questions');
            const question = pssQuestions[currentPssQuestion];
            
            container.innerHTML = `
                <div class="p-4 glass-light rounded-lg">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-sm font-medium text-blue-300">Pregunta ${question.id}/10</span>
                        <span class="text-sm font-medium text-blue-300">Puntuaci√≥n acumulada: ${calculateCurrentPSSScore()}</span>
                    </div>
                    <h4 class="text-lg font-bold text-glass-primary mb-4">${question.question}</h4>
                    <div class="space-y-2">
                        ${question.options.map((option, index) => `
                            <label class="flex items-center p-3 glass-light rounded-lg cursor-pointer hover:bg-white/10 transition">
                                <input type="radio" name="pss-answer" value="${option.value}" class="glass-radio mr-3" ${pssAnswers[currentPssQuestion] === option.value ? 'checked' : ''}>
                                <span class="text-glass-primary">${option.text}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prev-pss-question');
            const nextBtn = document.getElementById('next-pss-question');
            
            prevBtn.classList.toggle('hidden', currentPssQuestion === 0);
            
            if (currentPssQuestion === pssQuestions.length - 1) {
                nextBtn.innerHTML = 'Finalizar <i class="fas fa-check ml-2"></i>';
            } else {
                nextBtn.innerHTML = 'Siguiente <i class="fas fa-arrow-right ml-2"></i>';
            }
            
            // Add event listeners to radio buttons
            container.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    pssAnswers[currentPssQuestion] = parseInt(this.value);
                });
            });
        }

        function calculateCurrentPSSScore() {
            return pssAnswers.reduce((sum, answer) => sum + (answer || 0), 0);
        }

        function nextPSSQuestion() {
            // Save current answer if selected
            const selected = document.querySelector('input[name="pss-answer"]:checked');
            if (selected) {
                pssAnswers[currentPssQuestion] = parseInt(selected.value);
            } else if (pssAnswers[currentPssQuestion] === undefined) {
                showNotification('Por favor, selecciona una respuesta', 'warning');
                return;
            }
            
            if (currentPssQuestion < pssQuestions.length - 1) {
                currentPssQuestion++;
                loadPSSQuestion();
            } else {
                finishPSSAssessment();
            }
        }

        function prevPSSQuestion() {
            if (currentPssQuestion > 0) {
                currentPssQuestion--;
                loadPSSQuestion();
            }
        }

        function finishPSSAssessment() {
            const totalScore = calculateCurrentPSSScore();
            const assessment = {
                date: new Date().toISOString(),
                score: totalScore,
                answers: [...pssAnswers],
                interpretation: interpretPSSScore(totalScore)
            };
            
            appState.pssAssessments.push(assessment);
            appState.pssScore = totalScore;
            appState.lastPssDate = new Date().toISOString();
            
            // Log completion
            logAppUsage('pss_assessment', `completed_score_${totalScore}`);
            
            saveUserData();
            
            // Close modal
            closePSSModal();
            
            // Show results
            showPSSResults();
            
            // Update statistics
            updateStatistics();
            updateStatisticsDisplay(getActivePeriod());
        }

        function interpretPSSScore(score) {
            if (score <= 13) return "Bajo estr√©s";
            if (score <= 26) return "Estr√©s moderado";
            return "Alto estr√©s";
        }

        function showPSSResults() {
            if (appState.pssAssessments.length === 0) {
                showNotification('No hay evaluaciones PSS-10 completadas', 'warning');
                return;
            }
            
            const latest = appState.pssAssessments[appState.pssAssessments.length - 1];
            const date = new Date(latest.date).toLocaleDateString('es-ES');
            
            const resultDiv = document.getElementById('pss-assessment-result');
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = `
                <div class="mb-3">
                    <h4 class="font-bold text-glass-primary">√öltima evaluaci√≥n: ${date}</h4>
                    <div class="mt-2 p-3 ${latest.score <= 13 ? 'bg-green-500/20' : latest.score <= 26 ? 'bg-yellow-500/20' : 'bg-red-500/20'} rounded-lg glass-light">
                        <div class="flex justify-between items-center">
                            <span class="font-bold ${latest.score <= 13 ? 'text-green-300' : latest.score <= 26 ? 'text-yellow-300' : 'text-red-300'}">Puntuaci√≥n total:</span>
                            <span class="text-2xl font-bold text-white">${latest.score}/40</span>
                        </div>
                        <div class="mt-2">
                            <span class="font-medium ${latest.score <= 13 ? 'text-green-300' : latest.score <= 26 ? 'text-yellow-300' : 'text-red-300'}">Interpretaci√≥n:</span>
                            <span class="ml-2 text-white">${latest.interpretation}</span>
                        </div>
                    </div>
                </div>
                ${appState.pssAssessments.length > 1 ? `
                    <div class="mt-3">
                        <h5 class="font-bold text-glass-primary mb-2">Historial de evaluaciones:</h5>
                        <div class="space-y-2">
                            ${appState.pssAssessments.slice().reverse().map((assessment, index) => {
                                const date = new Date(assessment.date).toLocaleDateString('es-ES');
                                return `
                                    <div class="flex justify-between items-center p-2 glass-light rounded">
                                        <span class="text-glass-secondary">${date}</span>
                                        <span class="font-bold text-white">${assessment.score}/40</span>
                                        <span class="text-sm ${assessment.score <= 13 ? 'text-green-300' : assessment.score <= 26 ? 'text-yellow-300' : 'text-red-300'}">
                                            ${assessment.interpretation}
                                        </span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
            
            // Scroll to results
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function generateInitialStatistics() {
            const today = getCurrentDateKey();
            const currentWeek = getCurrentWeekKey();
            const currentMonth = getCurrentMonthKey();
            const currentYear = getCurrentYearKey();
            
            // Initialize statistics if empty
            if (Object.keys(appState.statistics.daily).length === 0) {
                appState.statistics.daily[today] = {
                    moodEntries: 0,
                    breathingSessions: 0,
                    groundingSessions: 0,
                    gratitudeEntries: 0,
                    habitsCompleted: 0,
                    wellnessScore: 85,
                    averageMood: 0,
                    sleepQuality: null
                };
            }
            
            if (Object.keys(appState.statistics.weekly).length === 0) {
                appState.statistics.weekly[currentWeek] = {
                    moodEntries: 0,
                    breathingSessions: 0,
                    groundingSessions: 0,
                    gratitudeEntries: 0,
                    habitsCompleted: 0,
                    averageWellness: 85,
                    averageMood: 0,
                    averageSleepQuality: 0,
                    pssScore: null
                };
            }
            
            if (Object.keys(appState.statistics.monthly).length === 0) {
                appState.statistics.monthly[currentMonth] = {
                    moodEntries: 0,
                    breathingSessions: 0,
                    groundingSessions: 0,
                    gratitudeEntries: 0,
                    habitsCompleted: 0,
                    averageWellness: 85,
                    averageMood: 0,
                    averageSleepQuality: 0,
                    pssScore: null,
                    consistency: 0
                };
            }
            
            if (Object.keys(appState.statistics.yearly).length === 0) {
                appState.statistics.yearly[currentYear] = {
                    moodEntries: 0,
                    breathingSessions: 0,
                    groundingSessions: 0,
                    gratitudeEntries: 0,
                    habitsCompleted: 0,
                    averageWellness: 85,
                    averageMood: 0,
                    averageSleepQuality: 0,
                    pssScore: null,
                    consistency: 0,
                    progress: 0
                };
            }
        }

        function updateStatistics() {
            const today = getCurrentDateKey();
            const currentWeek = getCurrentWeekKey();
            const currentMonth = getCurrentMonthKey();
            const currentYear = getCurrentYearKey();
            
            // Calculate daily statistics
            const todayActivities = appState.activityLog.filter(activity => 
                activity.date === today
            );
            
            const todayMoodEntries = appState.moodHistory.filter(mood => 
                mood.date === today
            );
            
            const todayGratitudeEntries = appState.gratitudeEntries.filter(entry => 
                new Date(entry.timestamp).toISOString().split('T')[0] === today
            );
            
            const habitsCompleted = Object.values(appState.habits).filter(Boolean).length;
            const wellnessScore = parseInt(document.getElementById('wellness-score').textContent);
            
            // Calculate average mood for today
            let averageMood = 0;
            if (todayMoodEntries.length > 0) {
                const moodSum = todayMoodEntries.reduce((sum, entry) => {
                    return sum + moodConfig[entry.mood].value;
                }, 0);
                averageMood = moodSum / todayMoodEntries.length;
            }
            
            // Update daily statistics
            appState.statistics.daily[today] = {
                moodEntries: todayMoodEntries.length,
                breathingSessions: todayActivities.filter(a => a.activity === 'breathing_exercise' && a.details.includes('completed')).length,
                groundingSessions: todayActivities.filter(a => a.activity === 'grounding_exercise' && a.details.includes('completed')).length,
                gratitudeEntries: todayGratitudeEntries.length,
                habitsCompleted: habitsCompleted,
                wellnessScore: wellnessScore,
                averageMood: parseFloat(averageMood.toFixed(1)),
                sleepQuality: appState.sleepQuality
            };
            
            // Calculate weekly statistics
            const weekActivities = appState.activityLog.filter(activity => 
                activity.week === currentWeek
            );
            
            const weekMoodEntries = appState.moodHistory.filter(mood => 
                mood.week === currentWeek
            );
            
            const weekGratitudeEntries = appState.gratitudeEntries.filter(entry => {
                const entryDate = new Date(entry.timestamp);
                const entryWeek = `${entryDate.getFullYear()}-W${Math.ceil((entryDate.getDate() + (entryDate.getDay() === 0 ? 6 : entryDate.getDay() - 1)) / 7)}`;
                return entryWeek === currentWeek;
            });
            
            const weekWellnessScores = appState.wellnessScores.filter(score => 
                score.date.startsWith(currentWeek.split('-')[0])
            );
            
            const averageWellness = weekWellnessScores.length > 0 ? 
                weekWellnessScores.reduce((sum, score) => sum + score.score, 0) / weekWellnessScores.length : 85;
            
            // Update weekly statistics
            appState.statistics.weekly[currentWeek] = {
                moodEntries: weekMoodEntries.length,
                breathingSessions: weekActivities.filter(a => a.activity === 'breathing_exercise' && a.details.includes('completed')).length,
                groundingSessions: weekActivities.filter(a => a.activity === 'grounding_exercise' && a.details.includes('completed')).length,
                gratitudeEntries: weekGratitudeEntries.length,
                habitsCompleted: habitsCompleted * 7, // Estimate for week
                averageWellness: parseFloat(averageWellness.toFixed(1)),
                averageMood: parseFloat(averageMood.toFixed(1)),
                averageSleepQuality: appState.sleepQuality || 0,
                pssScore: appState.pssScore
            };
            
            // Calculate monthly statistics
            const monthActivities = appState.activityLog.filter(activity => 
                activity.month === currentMonth
            );
            
            const monthMoodEntries = appState.moodHistory.filter(mood => 
                mood.month === currentMonth
            );
            
            // Update monthly statistics
            appState.statistics.monthly[currentMonth] = {
                moodEntries: monthMoodEntries.length,
                breathingSessions: monthActivities.filter(a => a.activity === 'breathing_exercise' && a.details.includes('completed')).length,
                groundingSessions: monthActivities.filter(a => a.activity === 'grounding_exercise' && a.details.includes('completed')).length,
                gratitudeEntries: appState.gratitudeEntries.filter(entry => 
                    entry.timestamp.startsWith(currentMonth)
                ).length,
                habitsCompleted: habitsCompleted * 30, // Estimate for month
                averageWellness: parseFloat(averageWellness.toFixed(1)),
                averageMood: parseFloat(averageMood.toFixed(1)),
                averageSleepQuality: appState.sleepQuality || 0,
                pssScore: appState.pssScore,
                consistency: calculateConsistency(monthActivities)
            };
            
            // Update yearly statistics
            appState.statistics.yearly[currentYear] = {
                moodEntries: appState.moodHistory.filter(mood => 
                    mood.year === currentYear
                ).length,
                breathingSessions: appState.activityLog.filter(a => 
                    a.activity === 'breathing_exercise' && a.details.includes('completed') && a.year === currentYear
                ).length,
                groundingSessions: appState.activityLog.filter(a => 
                    a.activity === 'grounding_exercise' && a.details.includes('completed') && a.year === currentYear
                ).length,
                gratitudeEntries: appState.gratitudeEntries.filter(entry => 
                    new Date(entry.timestamp).getFullYear().toString() === currentYear
                ).length,
                habitsCompleted: habitsCompleted * 365, // Estimate for year
                averageWellness: parseFloat(averageWellness.toFixed(1)),
                averageMood: parseFloat(averageMood.toFixed(1)),
                averageSleepQuality: appState.sleepQuality || 0,
                pssScore: appState.pssScore,
                consistency: calculateConsistency(monthActivities),
                progress: calculateProgress(appState.wellnessScores)
            };
            
            saveUserData();
        }

        function calculateConsistency(activities) {
            if (activities.length === 0) return 0;
            
            const uniqueDays = new Set(activities.map(a => a.date)).size;
            const totalDays = 30; // Assuming month
            return Math.round((uniqueDays / totalDays) * 100);
        }

        function calculateProgress(wellnessScores) {
            if (wellnessScores.length < 2) return 0;
            
            const firstScore = wellnessScores[0].score;
            const lastScore = wellnessScores[wellnessScores.length - 1].score;
            return ((lastScore - firstScore) / firstScore) * 100;
        }

        function updateStatisticsDisplay(period) {
            const container = document.getElementById('stats-content');
            const stats = appState.statistics[period];
            const latestKey = Object.keys(stats).pop();
            const currentStats = stats[latestKey] || {};
            
            let html = `
                <div class="p-4 glass-light rounded-lg">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-blue-500/20 p-3 rounded-lg glass-light">
                            <div class="text-sm text-blue-300 mb-1">Registros de √Ånimo</div>
                            <div class="text-2xl font-bold text-white">${currentStats.moodEntries || 0}</div>
                        </div>
                        <div class="bg-green-500/20 p-3 rounded-lg glass-light">
                            <div class="text-sm text-green-300 mb-1">Sesiones de Respiraci√≥n</div>
                            <div class="text-2xl font-bold text-white">${currentStats.breathingSessions || 0}</div>
                        </div>
                        <div class="bg-purple-500/20 p-3 rounded-lg glass-light">
                            <div class="text-sm text-purple-300 mb-1">Ejercicios Grounding</div>
                            <div class="text-2xl font-bold text-white">${currentStats.groundingSessions || 0}</div>
                        </div>
                        <div class="bg-yellow-500/20 p-3 rounded-lg glass-light">
                            <div class="text-sm text-yellow-300 mb-1">Entradas Gratitud</div>
                            <div class="text-2xl font-bold text-white">${currentStats.gratitudeEntries || 0}</div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
            `;
            
            // Add detailed statistics
            const statItems = [
                { label: 'Puntuaci√≥n Bienestar', value: currentStats.wellnessScore || currentStats.averageWellness || 85, suffix: '/100' },
                { label: 'Estado de √Ånimo Promedio', value: currentStats.averageMood || 0, suffix: '/5' },
                { label: 'H√°bitos Completados', value: currentStats.habitsCompleted || 0 },
                { label: 'Calidad de Sue√±o', value: currentStats.sleepQuality || currentStats.averageSleepQuality || 0, suffix: '/5' }
            ];
            
            if (currentStats.pssScore) {
                statItems.push({ 
                    label: 'Puntaje PSS-10', 
                    value: currentStats.pssScore, 
                    suffix: '/40',
                    color: currentStats.pssScore <= 13 ? 'text-green-300' : 
                           currentStats.pssScore <= 26 ? 'text-yellow-300' : 'text-red-300'
                });
            }
            
            if (currentStats.consistency) {
                statItems.push({ 
                    label: 'Consistencia', 
                    value: currentStats.consistency, 
                    suffix: '%' 
                });
            }
            
            if (currentStats.progress) {
                statItems.push({ 
                    label: 'Progreso General', 
                    value: currentStats.progress.toFixed(1), 
                    suffix: '%',
                    color: currentStats.progress >= 0 ? 'text-green-300' : 'text-red-300'
                });
            }
            
            statItems.forEach(item => {
                html += `
                    <div class="flex justify-between items-center p-2 border-b border-white/10">
                        <span class="font-medium text-glass-primary">${item.label}</span>
                        <span class="font-bold ${item.color || 'text-white'}">
                            ${item.value}${item.suffix || ''}
                        </span>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    
                    <div class="mt-4 p-3 glass-light rounded-lg">
                        <h4 class="font-bold text-glass-primary mb-2">üìà An√°lisis de Uso:</h4>
                        <p class="text-sm text-glass-secondary">
                            ${getUsageAnalysis(period, currentStats)}
                        </p>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Update wellness chart
            updateWellnessChart();
        }

        function getUsageAnalysis(period, stats) {
            const analyses = {
                diario: [
                    "Hoy has estado trabajando en tu bienestar emocional. ¬°Sigue as√≠!",
                    "Tu consistencia diaria es clave para el progreso a largo plazo.",
                    "Cada peque√±o paso cuenta en tu viaje hacia una mejor salud mental."
                ],
                semanal: [
                    "Esta semana has mostrado compromiso con tu autocuidado.",
                    "Observa los patrones semanales para identificar qu√© te ayuda m√°s.",
                    "La pr√°ctica constante es m√°s efectiva que esfuerzos espor√°dicos."
                ],
                mensual: [
                    "Un mes de dedicaci√≥n a tu salud mental. ¬°Excelente trabajo!",
                    "Los h√°bitos mensuales comienzan a formar nuevas rutinas cerebrales.",
                    "Reflexiona sobre tu progreso y ajusta tus estrategias seg√∫n necesites."
                ],
                anual: [
                    "Un a√±o completo de compromiso con tu bienestar. ¬°Incre√≠ble!",
                    "Mira cu√°nto has crecido y aprendido sobre ti mismo.",
                    "Este viaje anual te ha dado herramientas para toda la vida."
                ]
            };
            
            let analysis = analyses[period][Math.floor(Math.random() * analyses[period].length)];
            
            // Add specific feedback based on stats
            if (stats.moodEntries > 5) {
                analysis += " El registro regular de emociones te ayuda a identificar patrones.";
            }
            if (stats.breathingSessions > 3) {
                analysis += " Las t√©cnicas de respiraci√≥n son poderosas para regular el estr√©s.";
            }
            if (stats.gratitudeEntries > 2) {
                analysis += " Practicar gratitud fortalece las conexiones neuronales positivas.";
            }
            
            return analysis;
        }

        function initWellnessChart() {
            const ctx = document.getElementById('wellness-chart').getContext('2d');
            appState.wellnessChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Puntuaci√≥n de Bienestar',
                        data: [],
                        borderColor: 'rgba(255, 255, 255, 0.8)',
                        backgroundColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            titleColor: 'rgba(255, 255, 255, 0.9)',
                            bodyColor: 'rgba(255, 255, 255, 0.7)',
                            callbacks: {
                                label: function(context) {
                                    return `Bienestar: ${context.parsed.y}/100`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                callback: function(value) {
                                    return value + '/100';
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }

        function updateWellnessChart() {
            if (!appState.wellnessChart) return;
            
            // Get last 7 wellness scores
            const recentScores = appState.wellnessScores.slice(-7);
            const labels = recentScores.map(score => {
                const date = new Date(score.date);
                return date.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });
            });
            const data = recentScores.map(score => score.score);
            
            appState.wellnessChart.data.labels = labels;
            appState.wellnessChart.data.datasets[0].data = data;
            appState.wellnessChart.update();
        }

        function setActivePeriod(period) {
            document.querySelectorAll('.stats-period-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('border-white/40', 'text-white');
                btn.classList.add('border-transparent', 'text-glass-primary');
            });
            
            const activeBtn = document.querySelector(`.stats-period-btn[data-period="${period}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'border-white/40', 'text-white');
                activeBtn.classList.remove('border-transparent', 'text-glass-primary');
            }
        }

        function getActivePeriod() {
            const activeBtn = document.querySelector('.stats-period-btn.active');
            return activeBtn ? activeBtn.getAttribute('data-period') : 'diario';
        }

        // Helper functions for date keys
        function getCurrentDateKey() {
            const now = new Date();
            return now.toISOString().split('T')[0]; // YYYY-MM-DD
        }

        function getCurrentWeekKey() {
            const now = new Date();
            const startOfYear = new Date(now.getFullYear(), 0, 1);
            const days = Math.floor((now - startOfYear) / (24 * 60 * 60 * 1000));
            const weekNumber = Math.ceil((now.getDay() + 1 + days) / 7);
            return `${now.getFullYear()}-W${weekNumber}`;
        }

        function getCurrentMonthKey() {
            const now = new Date();
            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
        }

        function getCurrentYearKey() {
            return new Date().getFullYear().toString();
        }

        function exportUserData() {
            const dataStr = JSON.stringify(appState, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `calmapp-data-${getCurrentDateKey()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Datos exportados exitosamente', 'success');
        }

        function clearUserData() {
            if (confirm('¬øEst√°s seguro de que quieres borrar todos tus datos? Esta acci√≥n no se puede deshacer.')) {
                localStorage.removeItem('calmAppData');
                location.reload();
            }
        }

        // Load and save user data functions
        function loadUserData() {
            const savedData = localStorage.getItem('calmAppData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    // Merge loaded data with appState, preserving defaults
                    Object.keys(data).forEach(key => {
                        if (key in appState) {
                            if (typeof appState[key] === 'object' && appState[key] !== null) {
                                Object.assign(appState[key], data[key]);
                            } else {
                                appState[key] = data[key];
                            }
                        }
                    });
                    
                    console.log('Datos cargados desde localStorage');
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            }
        }

        function saveUserData() {
            try {
                localStorage.setItem('calmAppData', JSON.stringify(appState));
                console.log('Datos guardados en localStorage');
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        // Helper functions (placeholders for other functionality)
        function playClickSound() {
            // Play click sound if available
        }
        
        function showNotification(message, type = 'info') {
            // Create and show notification
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg glass-light border-l-4 ${
                type === 'success' ? 'border-green-500' : 
                type === 'warning' ? 'border-yellow-500' : 
                type === 'error' ? 'border-red-500' : 'border-blue-500'
            } z-50`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'times-circle' : 'info-circle'} mr-3 ${
                type === 'success' ? 'text-green-300' : 
                type === 'warning' ? 'text-yellow-300' : 
                type === 'error' ? 'text-red-300' : 'text-blue-300'
            }"></i>
                    <span class="text-glass-primary">${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function startSessionTimer() {
            appState.sessionStartTime = new Date();
            appState.sessionTimer = setInterval(() => {
                const now = new Date();
                const diff = now - appState.sessionStartTime;
                const minutes = Math.floor(diff / 60000);
                const seconds = Math.floor((diff % 60000) / 1000);
                document.getElementById('session-time').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        function updateDashboard() {
            // Update habits progress
            const habitsCompleted = Object.values(appState.habits).filter(Boolean).length;
            const progress = (habitsCompleted / 4) * 100;
            document.getElementById('habits-progress').textContent = `${progress}%`;
            document.getElementById('habits-progress-bar').style.width = `${progress}%`;
            
            // Update streak days (simulated)
            document.getElementById('streak-days').textContent = Math.floor(Math.random() * 30) + 1;
        }
        
        // Placeholder functions for unimplemented features
        function openCrisisModal(type) {
            const modal = document.getElementById('crisis-modal');
            const title = document.getElementById('crisis-modal-title');
            const content = document.getElementById('crisis-modal-content');
            
            const crisisData = {
                panic: {
                    title: 'Ataque de P√°nico/Ansiedad',
                    content: '<p class="text-glass-primary">Sigue estos pasos:</p><ol class="list-decimal pl-5 space-y-2 text-glass-primary"><li>Si√©ntate o recu√©state</li><li>Respira profundamente (4-7-8)</li><li>Conc√©ntrate en un objeto</li><li>Recuerda que pasar√°</li></ol>'
                },
                thoughts: {
                    title: 'Pensamientos Negativos Intrusivos',
                    content: '<p class="text-glass-primary">T√©cnicas para manejar pensamientos:</p><ul class="list-disc pl-5 space-y-2 text-glass-primary"><li>Identifica el pensamiento</li><li>Preg√∫ntate: ¬øEs √∫til?</li><li>Reempl√°zalo con uno positivo</li><li>Practica mindfulness</li></ul>'
                },
                grounding: {
                    title: 'Ejercicios de Grounding',
                    content: '<p class="text-glass-primary">Con√©ctate con el presente:</p><ul class="list-disc pl-5 space-y-2 text-glass-primary"><li>5 cosas que ves</li><li>4 cosas que tocas</li><li>3 cosas que oyes</li><li>2 cosas que hueles</li><li>1 cosa que saboreas</li></ul>'
                },
                breathing: {
                    title: 'Respiraci√≥n de Emergencia',
                    content: '<p class="text-glass-primary">T√©cnica 4-7-8:</p><ol class="list-decimal pl-5 space-y-2 text-glass-primary"><li>Inhala por 4 segundos</li><li>Mant√©n por 7 segundos</li><li>Exhala por 8 segundos</li><li>Repite 4 veces</li></ol>'
                }
            };
            
            title.textContent = crisisData[type].title;
            content.innerHTML = crisisData[type].content;
            modal.classList.remove('hidden');
        }
        
        function closeCrisisModal() {
            document.getElementById('crisis-modal').classList.add('hidden');
        }
        
        function closePSSModal() {
            document.getElementById('pss-modal').classList.add('hidden');
        }
        
        function closeStatsModal() {
            document.getElementById('stats-modal').classList.add('hidden');
        }
        
        function sendTherapyMessage() {
            const input = document.getElementById('therapy-input');
            const message = input.value.trim();
            if (!message) return;
            
            const container = document.getElementById('therapy-chat-container');
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'therapy-message user-message fade-in ml-auto';
            userMessage.innerHTML = `<p>${message}</p>`;
            container.appendChild(userMessage);
            
            // Clear input
            input.value = '';
            
            // Show loading
            document.getElementById('chatgpt-loading').classList.remove('hidden');
            
            // Simulate AI response
            setTimeout(() => {
                document.getElementById('chatgpt-loading').classList.add('hidden');
                
                const responses = [
                    "Entiendo c√≥mo te sientes. Es normal tener esos momentos. ¬øHas intentado alguna t√©cnica de respiraci√≥n para calmarte?",
                    "Gracias por compartir eso. Los pensamientos negativos pueden ser abrumadores. ¬øPodr√≠as identificar qu√© desencadena esos pensamientos?",
                    "Es importante reconocer tus emociones. ¬øHay algo espec√≠fico que haya sucedido hoy que te haga sentir as√≠?",
                    "Recuerda que las emociones son temporales. ¬øTe gustar√≠a probar un ejercicio de mindfulness juntos?",
                    "Tu experiencia es v√°lida. ¬øHas considerado llevar un diario para registrar estos pensamientos y patrones?"
                ];
                
                const aiResponse = responses[Math.floor(Math.random() * responses.length)];
                
                const aiMessage = document.createElement('div');
                aiMessage.className = 'therapy-message therapist-message fade-in';
                aiMessage.innerHTML = `<p>${aiResponse}</p>`;
                container.appendChild(aiMessage);
                
                // Scroll to bottom
                container.scrollTop = container.scrollHeight;
            }, 1500);
        }
        
        function startCBTTechnique(technique) {
            showNotification(`Iniciando t√©cnica ${technique}...`, 'info');
        }
        
        function recordSleepQuality(quality) {
            appState.sleepQuality = quality;
            showNotification(`Calidad de sue√±o registrada: ${quality}/5`, 'success');
            logAppUsage('sleep_quality', quality);
        }
        
        function activateScenario(scenario) {
            appState.activeScenario = scenario;
            document.querySelectorAll('.sound-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.sound-item[data-scenario="${scenario}"]`).classList.add('active');
            showNotification(`Escenario activado: ${scenario}`, 'info');
            logAppUsage('ambient_scenario', scenario);
        }
        
        function stopWimHofBreathing() {
            if (appState.breathingActive) {
                appState.breathingActive = false;
                document.getElementById('breathing-balloon').classList.remove('inhaling', 'exhaling', 'holding');
                document.getElementById('breath-phase').textContent = 'DETENIDO';
                showNotification('Respiraci√≥n detenida', 'warning');
            }
        }
        
        function resetBreathing() {
            appState.breathingActive = false;
            appState.breathCount = 0;
            document.getElementById('breathing-balloon').classList.remove('inhaling', 'exhaling', 'holding');
            document.getElementById('breath-phase').textContent = 'LISTO';
            document.getElementById('breath-cycle').textContent = '0';
            document.getElementById('breath-cycle-display').textContent = '0/30';
            document.getElementById('current-instruction').textContent = 'Presiona "Comenzar" para iniciar';
            showNotification('Respiraci√≥n reiniciada', 'info');
        }
        
        function toggleVoice() {
            appState.voiceEnabled = !appState.voiceEnabled;
            const button = document.getElementById('toggle-voice');
            if (appState.voiceEnabled) {
                button.innerHTML = '<i class="fas fa-volume-up"></i><span>Desactivar Voz</span>';
                showNotification('Voz activada', 'success');
            } else {
                button.innerHTML = '<i class="fas fa-volume-mute"></i><span>Activar Voz</span>';
                showNotification('Voz desactivada', 'warning');
            }
        }
        
        function testVoice() {
            speakText("Esta es una prueba de voz. La gu√≠a de voz est√° funcionando correctamente.");
            showNotification('Probando voz...', 'info');
        }
        
        function startCompassionExercise(exercise) {
            const exercises = {
                selfTalk: "Habla contigo mismo como lo har√≠as con un amigo querido. Di: 'Est√° bien sentirse as√≠, soy humano'.",
                handOnHeart: "Coloca tu mano sobre tu coraz√≥n. Siente el calor y el latido. Respira profundamente.",
                forgiveness: "Perd√≥nate por cualquier error. Recuerda que todos cometemos errores y aprendemos.",
                commonHumanity: "Recuerda que no est√°s solo. Muchas personas pasan por experiencias similares."
            };
            speakText(exercises[exercise]);
            showNotification(`Ejercicio de autocompasi√≥n: ${exercise}`, 'info');
            logAppUsage('compassion_exercise', exercise);
        }
        
        function saveTherapyPrepNotes() {
            const notes = document.getElementById('therapy-prep').value.trim();
            if (notes) {
                appState.therapyPrepNotes = notes;
                showNotification('Notas para terapia guardadas', 'success');
                logAppUsage('therapy_prep', 'notes_saved');
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
