<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalmDown - Tu Refugio Mental</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.9.14/build/Tone.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .breathing-circle {
            animation: breathe 4s ease-in-out infinite;
        }
        
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        
        .float {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .wave {
            animation: wave 3s ease-in-out infinite;
        }
        
        @keyframes wave {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }
        
        .mood-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .mood-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .chat-bubble {
            animation: slideIn 0.4s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .pulse-soft {
            animation: pulseSoft 2s ease-in-out infinite;
        }
        
        @keyframes pulseSoft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .sound-wave {
            display: inline-block;
            width: 4px;
            height: 20px;
            margin: 0 2px;
            background: linear-gradient(to top, #667eea, #764ba2);
            animation: soundWave 1s ease-in-out infinite;
        }
        
        @keyframes soundWave {
            0%, 100% { height: 10px; }
            50% { height: 25px; }
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-7xl mx-auto">
        
        <!-- Header con dise√±o m√°s emp√°tico -->
        <header class="text-center mb-8 glass-card p-8 rounded-3xl">
            <div class="flex items-center justify-center gap-4 mb-4">
                <div class="breathing-circle w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full"></div>
                <h1 class="text-5xl font-bold gradient-text">CalmDown</h1>
                <div class="breathing-circle w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full"></div>
            </div>
            <p class="text-lg text-gray-600 font-medium">Tu refugio personal de paz y bienestar</p>
            <p class="text-sm text-gray-500 mt-2">Basado en neurociencia y psicolog√≠a positiva</p>
            <div id="user-info" class="text-xs text-gray-400 mt-3"></div>
            <button id="start-audio-btn" class="mt-4 px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-semibold rounded-full transition duration-300 shadow-lg hidden">
                üéµ Activar Experiencia de Audio
            </button>
        </header>

        <!-- Estado Mental Actual - Nuevo componente emp√°tico -->
        <div class="glass-card p-6 rounded-3xl mb-8">
            <h2 class="text-2xl font-bold text-center mb-4 gradient-text">¬øC√≥mo te sientes en este momento?</h2>
            <p class="text-center text-gray-600 text-sm mb-6">Reconocer tus emociones es el primer paso hacia el bienestar</p>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="quickMoodLog('Tranquilo')" class="mood-btn glass-card p-6 rounded-2xl text-center">
                    <div class="text-5xl mb-2">üòå</div>
                    <p class="font-semibold text-gray-700">Tranquilo</p>
                    <p class="text-xs text-gray-500">En paz</p>
                </button>
                <button onclick="quickMoodLog('Feliz')" class="mood-btn glass-card p-6 rounded-2xl text-center">
                    <div class="text-5xl mb-2">üòä</div>
                    <p class="font-semibold text-gray-700">Feliz</p>
                    <p class="text-xs text-gray-500">Contento</p>
                </button>
                <button onclick="quickMoodLog('Ansioso')" class="mood-btn glass-card p-6 rounded-2xl text-center">
                    <div class="text-5xl mb-2">üò∞</div>
                    <p class="font-semibold text-gray-700">Ansioso</p>
                    <p class="text-xs text-gray-500">Preocupado</p>
                </button>
                <button onclick="quickMoodLog('Estresado')" class="mood-btn glass-card p-6 rounded-2xl text-center">
                    <div class="text-5xl mb-2">üòì</div>
                    <p class="font-semibold text-gray-700">Estresado</p>
                    <p class="text-xs text-gray-500">Abrumado</p>
                </button>
            </div>
            
            <div id="quick-mood-feedback" class="mt-4 text-center text-sm font-medium hidden"></div>
        </div>

        <!-- Grid Principal -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Columna 1: Respira Conmigo -->
            <div class="glass-card p-6 rounded-3xl">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center">
                        <span class="text-2xl">ü´Å</span>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Respira Conmigo</h3>
                        <p class="text-xs text-gray-500">Activa tu sistema nervioso parasimp√°tico</p>
                    </div>
                </div>
                
                <div class="relative h-64 flex items-center justify-center mb-4">
                    <div id="breathing-guide" class="absolute w-32 h-32 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full opacity-70"></div>
                    <p id="breathing-text" class="text-2xl font-bold text-gray-700 z-10 relative">Inhala</p>
                </div>
                
                <button id="start-breathing-btn" class="w-full py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold rounded-xl shadow-lg transition">
                    Comenzar Ejercicio
                </button>
                
                <div class="mt-4 p-4 bg-blue-50 rounded-xl">
                    <p class="text-xs text-blue-800 leading-relaxed">
                        <strong>Beneficio:</strong> La respiraci√≥n consciente reduce el cortisol (hormona del estr√©s) hasta un 30% en solo 5 minutos.
                    </p>
                </div>
            </div>

            <!-- Columna 2: Ejercicios Personalizados -->
            <div class="glass-card p-6 rounded-3xl">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center">
                        <span class="text-2xl">üßò‚Äç‚ôÄÔ∏è</span>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Tu Gu√≠a Personal</h3>
                        <p class="text-xs text-gray-500">Ejercicios creados por IA con voz</p>
                    </div>
                </div>
                
                <div class="space-y-3 mb-4">
                    <div class="tooltip" data-tip="Reduce ansiedad un 45%">
                        <button onclick="selectExercise('respiracion')" class="exercise-btn w-full p-4 bg-gradient-to-r from-blue-100 to-blue-200 hover:from-blue-200 hover:to-blue-300 rounded-xl text-left transition">
                            <div class="flex items-center gap-3">
                                <span class="text-3xl">üå¨Ô∏è</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Respiraci√≥n Profunda</p>
                                    <p class="text-xs text-gray-600">5 min ‚Ä¢ Ansiedad</p>
                                </div>
                            </div>
                        </button>
                    </div>
                    
                    <div class="tooltip" data-tip="Mejora concentraci√≥n un 60%">
                        <button onclick="selectExercise('meditacion')" class="exercise-btn w-full p-4 bg-gradient-to-r from-purple-100 to-purple-200 hover:from-purple-200 hover:to-purple-300 rounded-xl text-left transition">
                            <div class="flex items-center gap-3">
                                <span class="text-3xl">üßò</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Meditaci√≥n Mindfulness</p>
                                    <p class="text-xs text-gray-600">7 min ‚Ä¢ Concentraci√≥n</p>
                                </div>
                            </div>
                        </button>
                    </div>
                    
                    <div class="tooltip" data-tip="Reduce tensi√≥n muscular un 70%">
                        <button onclick="selectExercise('relajacion')" class="exercise-btn w-full p-4 bg-gradient-to-r from-green-100 to-green-200 hover:from-green-200 hover:to-green-300 rounded-xl text-left transition">
                            <div class="flex items-center gap-3">
                                <span class="text-3xl">üòå</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Relajaci√≥n Muscular</p>
                                    <p class="text-xs text-gray-600">10 min ‚Ä¢ Tensi√≥n f√≠sica</p>
                                </div>
                            </div>
                        </button>
                    </div>
                    
                    <div class="tooltip" data-tip="Activa ondas theta del cerebro">
                        <button onclick="selectExercise('visualizacion')" class="exercise-btn w-full p-4 bg-gradient-to-r from-pink-100 to-pink-200 hover:from-pink-200 hover:to-pink-300 rounded-xl text-left transition">
                            <div class="flex items-center gap-3">
                                <span class="text-3xl">üåÑ</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Visualizaci√≥n Guiada</p>
                                    <p class="text-xs text-gray-600">8 min ‚Ä¢ Calma profunda</p>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>
                
                <button id="generate-exercise-btn" class="w-full py-3 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold rounded-xl shadow-lg transition" disabled>
                    Generar Mi Gu√≠a üéß
                </button>
                
                <div id="exercise-output" class="mt-4 glass-card p-4 rounded-xl hidden">
                    <audio id="audio-player" controls class="w-full mb-3"></audio>
                    <p id="exercise-text" class="text-sm text-gray-700 leading-relaxed"></p>
                </div>
                
                <div id="loading-indicator" class="mt-4 text-center hidden">
                    <div class="flex items-center justify-center gap-2">
                        <div class="sound-wave" style="animation-delay: 0s"></div>
                        <div class="sound-wave" style="animation-delay: 0.2s"></div>
                        <div class="sound-wave" style="animation-delay: 0.4s"></div>
                        <div class="sound-wave" style="animation-delay: 0.6s"></div>
                    </div>
                    <p class="text-sm text-purple-600 mt-2 font-medium">Creando tu experiencia...</p>
                </div>
            </div>

            <!-- Columna 3: Sonidos de la Naturaleza -->
            <div class="glass-card p-6 rounded-3xl">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center">
                        <span class="text-2xl">üéµ</span>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Sonidos Terap√©uticos</h3>
                        <p class="text-xs text-gray-500">Basados en terapia de sonido</p>
                    </div>
                </div>
                
                <audio id="ambient-audio" loop class="hidden"></audio>
                
                <div class="space-y-2 mb-4 max-h-96 overflow-y-auto">
                    <button onclick="playAmbientSound('rain')" class="w-full p-3 bg-gradient-to-r from-blue-50 to-cyan-50 hover:from-blue-100 hover:to-cyan-100 rounded-xl text-left transition flex items-center gap-3">
                        <span class="text-2xl">üåßÔ∏è</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-sm">Lluvia Suave</p>
                            <p class="text-xs text-gray-600">Reduce frecuencia card√≠aca</p>
                        </div>
                    </button>
                    
                    <button onclick="playAmbientSound('ocean')" class="w-full p-3 bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 rounded-xl text-left transition flex items-center gap-3">
                        <span class="text-2xl">üåä</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-sm">Olas del Oc√©ano</p>
                            <p class="text-xs text-gray-600">Induce ondas alfa</p>
                        </div>
                    </button>
                    
                    <button onclick="playAmbientSound('forest')" class="w-full p-3 bg-gradient-to-r from-green-50 to-emerald-50 hover:from-green-100 hover:to-emerald-100 rounded-xl text-left transition flex items-center gap-3">
                        <span class="text-2xl">üå≤</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-sm">Bosque Tranquilo</p>
                            <p class="text-xs text-gray-600">Efecto Shinrin-yoku</p>
                        </div>
                    </button>
                    
                    <button onclick="playAmbientSound('fireplace')" class="w-full p-3 bg-gradient-to-r from-orange-50 to-red-50 hover:from-orange-100 hover:to-red-100 rounded-xl text-left transition flex items-center gap-3">
                        <span class="text-2xl">üî•</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-sm">Chimenea</p>
                            <p class="text-xs text-gray-600">Sensaci√≥n de calidez</p>
                        </div>
                    </button>
                    
                    <button onclick="playAmbientSound('birds')" class="w-full p-3 bg-gradient-to-r from-yellow-50 to-amber-50 hover:from-yellow-100 hover:to-amber-100 rounded-xl text-left transition flex items-center gap-3">
                        <span class="text-2xl">üê¶</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-sm">P√°jaros</p>
                            <p class="text-xs text-gray-600">Aumenta serotonina</p>
                        </div>
                    </button>
                    
                    <button onclick="playAmbientSound('classical')" class="w-full p-3 bg-gradient-to-r from-purple-50 to-pink-50 hover:from-purple-100 hover:to-pink-100 rounded-xl text-left transition flex items-center gap-3">
                        <span class="text-2xl">üéª</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-sm">M√∫sica Cl√°sica</p>
                            <p class="text-xs text-gray-600">Efecto Mozart</p>
                        </div>
                    </button>
                    
                    <button onclick="playAmbientSound('meditation')" class="w-full p-3 bg-gradient-to-r from-indigo-50 to-purple-50 hover:from-indigo-100 hover:to-purple-100 rounded-xl text-left transition flex items-center gap-3">
                        <span class="text-2xl">üßò</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-sm">Meditaci√≥n</p>
                            <p class="text-xs text-gray-600">Ondas theta</p>
                        </div>
                    </button>
                    
                    <button onclick="playAmbientSound('tibetan')" class="w-full p-3 bg-gradient-to-r from-pink-50 to-rose-50 hover:from-pink-100 hover:to-rose-100 rounded-xl text-left transition flex items-center gap-3">
                        <span class="text-2xl">üîî</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-sm">Cuencos Tibetanos</p>
                            <p class="text-xs text-gray-600">Vibraci√≥n celular</p>
                        </div>
                    </button>
                    
                    <button onclick="playAmbientSound('piano')" class="w-full p-3 bg-gradient-to-r from-violet-50 to-purple-50 hover:from-violet-100 hover:to-purple-100 rounded-xl text-left transition flex items-center gap-3">
                        <span class="text-2xl">üéπ</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-sm">Piano Relajante</p>
                            <p class="text-xs text-gray-600">Balance emocional</p>
                        </div>
                    </button>
                </div>
                
                <button onclick="stopAmbientSound()" class="w-full py-2 bg-red-100 hover:bg-red-200 text-red-700 font-semibold rounded-xl transition mb-3">
                    ‚èπÔ∏è Detener
                </button>
                
                <div id="ambient-status" class="text-center text-sm p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl"></div>
                
                <div class="mt-3">
                    <label class="block text-xs font-semibold text-gray-700 mb-2">Volumen</label>
                    <input type="range" id="volume-slider" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg cursor-pointer">
                </div>
            </div>

        </div>

        <!-- Segunda Fila: Chat y Tracking -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">

            <!-- Chat Emp√°tico con IA -->
            <div class="glass-card p-6 rounded-3xl">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center pulse-soft">
                        <span class="text-2xl">üí¨</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-800">Tu Compa√±ero Emp√°tico</h3>
                        <p class="text-xs text-gray-500">Escucha activa sin juicios ‚Ä¢ 100% privado</p>
                    </div>
                </div>
                
                <div class="mb-4 p-3 bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-200 rounded-xl">
                    <label class="block text-xs font-semibold text-indigo-800 mb-2">Modelo de IA:</label>
                    <select id="ai-model-select" class="w-full p-2 border border-indigo-300 rounded-lg text-sm font-medium focus:ring-2 focus:ring-indigo-400">
                        <option value="openai">ü§ñ OpenAI (Conversacional)</option>
                        <option value="deepseek">üß† DeepSeek (Econ√≥mico)</option>
                    </select>
                </div>
                
                <div id="openai-instructions" class="mb-3 p-3 bg-green-50 border border-green-200 rounded-xl text-xs">
                    <p class="font-semibold text-green-800 mb-1">üìù Configura OpenAI:</p>
                    <a href="https://platform.openai.com/api-keys" target="_blank" class="text-green-700 underline">platform.openai.com/api-keys</a>
                </div>
                
                <div id="deepseek-instructions" class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-xl text-xs hidden">
                    <p class="font-semibold text-blue-800 mb-1">üìù Configura DeepSeek:</p>
                    <a href="https://platform.deepseek.com" target="_blank" class="text-blue-700 underline">platform.deepseek.com</a>
                </div>
                
                <div class="mb-4">
                    <input type="password" id="ai-api-input" placeholder="sk-..." class="w-full p-3 border border-gray-300 rounded-xl text-sm focus:ring-2 focus:ring-indigo-400">
                    <button id="save-api-key-btn" class="mt-2 w-full py-2 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white font-semibold rounded-lg text-sm transition">
                        Activar üîë
                    </button>
                    <p id="api-status" class="text-xs mt-2 font-medium text-center"></p>
                </div>
                
                <div id="chat-container" class="h-72 overflow-y-auto bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 mb-4 space-y-3">
                    <div class="text-center text-gray-400 text-sm">Configura tu API para comenzar...</div>
                </div>

                <div class="flex gap-2">
                    <input type="text" id="chat-input" placeholder="Comparte c√≥mo te sientes..." class="flex-1 p-3 border border-gray-300 rounded-xl text-sm focus:ring-2 focus:ring-indigo-400" disabled>
                    <button id="send-chat-btn" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-bold rounded-xl transition disabled:opacity-50" disabled>
                        Enviar
                    </button>
                </div>
                <div id="chat-loading" class="mt-2 text-center text-sm text-indigo-600 hidden">
                    <div class="flex items-center justify-center gap-1">
                        <div class="sound-wave" style="height: 12px"></div>
                        <div class="sound-wave" style="height: 12px; animation-delay: 0.2s"></div>
                        <div class="sound-wave" style="height: 12px; animation-delay: 0.4s"></div>
                    </div>
                    <span class="text-xs">Escuchando...</span>
                </div>
            </div>

            <!-- Diario Emocional -->
            <div class="glass-card p-6 rounded-3xl">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center">
                        <span class="text-2xl">üìî</span>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Diario Emocional</h3>
                        <p class="text-xs text-gray-500">Monitorea tu bienestar d√≠a a d√≠a</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">¬øC√≥mo describes tu d√≠a?</label>
                    <select id="mood-select" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-400">
                        <option value="Excelente">ü•≥ Excelente - Me siento incre√≠ble</option>
                        <option value="Bien">üòä Bien - Todo fluye</option>
                        <option value="Neutral">üòê Neutral - Un d√≠a m√°s</option>
                        <option value="Ansioso">üòü Ansioso - Algo preocupado</option>
                        <option value="Estresado">üòì Estresado - Mucha presi√≥n</option>
                        <option value="Triste">üòî Tr
